
## 1.locå’ŒilocåŒºåˆ«
`loc`å’Œ`iloc`æ˜¯ä¸¤ç§ä¸åŒçš„ç´¢å¼•æ–¹å¼ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºç´¢å¼•çš„ä¾æ®ï¼š

1. `questions.loc[1, 'Incorrect Answers']`:
    
    - ä½¿ç”¨æ ‡ç­¾ï¼ˆlabelï¼‰è¿›è¡Œç´¢å¼•
    - ç¬¬ä¸€ä¸ªå‚æ•°`1`æ˜¯è¡Œç´¢å¼•æ ‡ç­¾ï¼ˆå³è¡Œçš„åç§°æˆ–ç´¢å¼•å€¼ï¼‰
    - ç¬¬äºŒä¸ªå‚æ•°`'Incorrect Answers'`æ˜¯åˆ—å
    - è¿™ç§æ–¹å¼é€šè¿‡è¡Œæ ‡ç­¾å’Œåˆ—åæ¥å®šä½æ•°æ®
2. `questions.iloc[1, 'Incorrect Answers']`:
    
    - ä½¿ç”¨æ•´æ•°ä½ç½®è¿›è¡Œç´¢å¼•
    - ç¬¬ä¸€ä¸ªå‚æ•°`1`æ˜¯è¡Œçš„æ•´æ•°ä½ç½®ï¼ˆä»0å¼€å§‹è®¡æ•°ï¼‰
    - ç¬¬äºŒä¸ªå‚æ•°åº”è¯¥æ˜¯åˆ—çš„æ•´æ•°ä½ç½®ï¼Œè€Œä¸æ˜¯åˆ—å
    - æ³¨æ„ï¼š`iloc`é€šå¸¸ä¸æ¥å—åˆ—åä½œä¸ºå‚æ•°ï¼Œå¦‚æœè¦ä½¿ç”¨åˆ—åï¼Œåº”è¯¥ç”¨`loc`

# 2ã€a\[:,\[1 2]] å’Œa\[range(len(a)),\[1 2 ]] åŒºåˆ«

outputs\[:, prompt_ids.squeeze(0)].shape ä¸ outputs\[range(outputs.shape\[0]), prompt_ids.squeeze(0)].shape

è¿™ä¸¤ç§PyTorchç´¢å¼•æ–¹å¼åœ¨ç»“æœå½¢çŠ¶å’Œå«ä¹‰ä¸Šæœ‰é‡è¦åŒºåˆ«ï¼š

1. **`outputs[:, prompt_ids.squeeze(0)]`**:
    
    - è¿™æ˜¯åŸºæœ¬çš„åˆ‡ç‰‡ç´¢å¼•
    - `:`è¡¨ç¤ºé€‰æ‹©æ‰€æœ‰è¡Œ
    - `prompt_ids.squeeze(0)`æ˜¯ä¸€ä¸ªä¸€ç»´å¼ é‡ï¼ŒåŒ…å«è¦é€‰æ‹©çš„åˆ—ç´¢å¼•
    - ç»“æœå½¢çŠ¶ä¸º`(outputs.shape[0], prompt_ids.squeeze(0).shape[0])`
    - è¿™ä¼šåˆ›å»ºä¸€ä¸ªäºŒç»´çŸ©é˜µï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰è¡Œåœ¨æŒ‡å®šåˆ—ç´¢å¼•ä½ç½®çš„å€¼
    - ä¾‹å¦‚ï¼Œå¦‚æœ`outputs`å½¢çŠ¶ä¸º`(5, 10)`ï¼Œ`prompt_ids.squeeze(0)`ä¸º`[1, 3, 2]`ï¼Œåˆ™ç»“æœå½¢çŠ¶ä¸º`(5, 3)`
2. **`outputs[range(outputs.shape[0]), prompt_ids.squeeze(0)]`**:
    
    - è¿™æ˜¯é«˜çº§ç´¢å¼•ï¼ˆadvanced indexingï¼‰
    - `range(outputs.shape[0])`åˆ›å»ºä¸€ä¸ªè¡Œç´¢å¼•åºåˆ—`[0, 1, 2, ..., outputs.shape[0]-1]`
    - `prompt_ids.squeeze(0)`æ˜¯åˆ—ç´¢å¼•åºåˆ—
    - ä¸¤ä¸ªç´¢å¼•åºåˆ—é•¿åº¦å¿…é¡»ç›¸åŒ
    - ç»“æœå½¢çŠ¶ä¸º`(outputs.shape[0],)`ï¼Œæ˜¯ä¸€ç»´å¼ é‡
    - è¿™ç§ç´¢å¼•æ–¹å¼ä¼šè¿”å›ä¸€ä¸ªä¸€ç»´å¼ é‡ï¼Œå…¶ä¸­ç¬¬iä¸ªå…ƒç´ æ˜¯`outputs[i, prompt_ids.squeeze(0)[i]]`
    - ä¾‹å¦‚ï¼Œå¦‚æœ`outputs`å½¢çŠ¶ä¸º`(5, 10)`ï¼Œ`range(outputs.shape[0])`ä¸º`[0, 1, 2, 3, 4]`ï¼Œ`prompt_ids.squeeze(0)`ä¸º`[1, 3, 2, 0, 4]`ï¼Œåˆ™ç»“æœå½¢çŠ¶ä¸º`(5,)`ï¼ŒåŒ…å«å…ƒç´ `[outputs[0,1], outputs[1,3], outputs[2,2], outputs[3,0], outputs[4,4]]`

**å…³é”®åŒºåˆ«**ï¼š

- ç¬¬ä¸€ç§æ–¹å¼è¿”å›ä¸€ä¸ªäºŒç»´çŸ©é˜µï¼ŒåŒ…å«æ‰€æœ‰è¡Œåœ¨æŒ‡å®šåˆ—çš„å€¼
- ç¬¬äºŒç§æ–¹å¼è¿”å›ä¸€ä¸ªä¸€ç»´å‘é‡ï¼ŒåªåŒ…å«å¯¹è§’çº¿ä¸Šçš„å…ƒç´ ï¼ˆæŒ‰ç´¢å¼•å¯¹åº”å…³ç³»ï¼‰


# 3ã€pd.to_csvæ–¹æ³•

```
model_outputs = pd.read_csv('./helpsteer/helpfulness_model_outputs_seed42_n100.csv')
```



```
# iloc[index]è¿™æ ·å–åªæœ‰ä¸€ä¸ªå…ƒç´ å°±ä¼šå˜æˆä¸€ä¸ªseriesï¼Œæ˜¯ç«–ç€çš„
model_outputs.iloc[0].to_csv('./_outputs_seed42_n100_test.csv', index=False)
# iloc[index:index+1]è¿™æ ·å–ï¼Œè¿˜æ˜¯ä¸€ä¸ªdf
model_outputs.iloc[0:1].to_csv('./_outputs_seed42_n100_test.csv', index=False)
# model_outputs.iloc[0]['prompt']
```


# 4ã€df.groupby
### ğŸ§  èƒŒæ™¯

BBQ æ•°æ®é›†æ˜¯ä¸€ä¸ªå¤šç±»åˆ«ï¼ˆmulti-categoryï¼‰åè§è¯„ä¼°æ•°æ®é›†ã€‚  
ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½åŒ…å«ä»¥ä¸‹ç±»åˆ«ï¼š

`age gender_identity race_ethnicity nationality religion ...`

ä¸åŒç±»åˆ«çš„æ•°æ®é‡å¯èƒ½ç›¸å·®å¾ˆå¤§ï¼Œæ¯”å¦‚ï¼š

|category|æ ·æœ¬æ•°|
|---|---|
|age|500|
|gender_identity|1200|
|race_ethnicity|800|
|...|...|

å¦‚æœæˆ‘ä»¬ç›´æ¥åˆå¹¶ä½¿ç”¨ï¼Œä¼šå¯¼è‡´æ¨¡å‹åœ¨è®­ç»ƒæˆ–è¯„ä¼°æ—¶è¢«â€œå¤§æ ·æœ¬ç±»â€ä¸»å¯¼ï¼Œç»“æœä¸å¹³è¡¡ã€‚  
æ‰€ä»¥æˆ‘ä»¬å¸Œæœ›è®©æ¯ä¸ªç±»åˆ«åœ¨æ•´ä½“ä¸­**å ä¸€æ ·çš„æ¯”ä¾‹ï¼ˆå‡è¡¡é‡‡æ ·ï¼‰**ã€‚

### ğŸ§© å®ç°æ–¹å¼

å…³é”®ä»£ç æ˜¯è¿™è¡Œï¼š

`balanced_df = df.groupby('category', group_keys=False).apply(lambda x: x.sample(n=min_samples, random_state=42))`

è®©æˆ‘ä»¬æ‹†å¼€æ¥çœ‹ğŸ‘‡

#### â‘ Â `df.groupby('category')`

- è¿™ä¼šæŠŠæ•´ä¸ª DataFrame æŒ‰ç…§Â `category`Â åˆ—åˆ†æˆå¤šä¸ªå°ç»„ã€‚
    
- æ¯ä¸ªç»„åªåŒ…å«è¯¥ç±»åˆ«çš„æ•°æ®ã€‚
    
- ä¾‹å¦‚ï¼š
    - group1: æ‰€æœ‰Â `age`Â ç±»çš„æ•°æ®
    - group2: æ‰€æœ‰Â `gender_identity`Â ç±»çš„æ•°æ®
    - group3: æ‰€æœ‰Â `race_ethnicity`Â ç±»çš„æ•°æ®
        

#### â‘¡Â `.apply(lambda x: x.sample(n=min_samples, random_state=42))`

- å¯¹æ¯ä¸ªç»„æ‰§è¡Œé‡‡æ ·æ“ä½œï¼š
    - `x`Â æ˜¯å½“å‰ç±»åˆ«çš„æ•°æ®ã€‚
    - `.sample(n=min_samples)`Â éšæœºæŠ½å–Â `min_samples`Â æ¡æ ·æœ¬ã€‚
        
- å› ä¸ºæˆ‘ä»¬äº‹å…ˆè®¡ç®—äº†ï¼š
    `min_samples = min(df['category'].value_counts())`
    
    æ‰€ä»¥æ¯ä¸€ç±»éƒ½è¢«ä¸‹é‡‡æ ·åˆ°Â **ç›¸åŒçš„æ ·æœ¬æ•°**ã€‚

è¿™æ ·å°±å®ç°äº†**ç±»åˆ«å‡è¡¡ï¼ˆbalanced samplingï¼‰**ï¼š  
æ‰€æœ‰ç±»åˆ«çš„æ•°æ®é‡ä¸€è‡´ï¼Œä¸ä¼šæœ‰åæ–œã€‚

#### â‘¢Â `group_keys=False`

- é¿å… Pandas åœ¨åˆ†ç»„åæŠŠç±»åˆ«åä½œä¸ºå¤šçº§ç´¢å¼•çš„ä¸Šå±‚ indexï¼Œä¿æŒ DataFrame æ‰å¹³ç»“æ„ï¼Œæ–¹ä¾¿åç»­ä¿å­˜ã€‚

# df.to_dict ä¸­æ–‡æ€»ç»“
`DataFrame.to_dict()` ç”¨äºå°† DataFrame è½¬æ¢ä¸ºå­—å…¸ï¼ˆæˆ–æŒ‡å®šçš„å¯å˜æ˜ å°„ç±»å‹ï¼‰ï¼Œæ ¸å¿ƒé€šè¿‡ `orient` å‚æ•°æ§åˆ¶è½¬æ¢æ ¼å¼ï¼Œæ”¯æŒçµæ´»çš„ç»“æ„å®šåˆ¶ã€‚


## æ ¸å¿ƒå‚æ•°è¯´æ˜
| å‚æ•°       | ä½œç”¨æè¿°                                                                 |
|------------|--------------------------------------------------------------------------|
| `orient`   | æ§åˆ¶è¿”å›å­—å…¸çš„ç»“æ„ï¼ˆå¿…é€‰ï¼Œé»˜è®¤ `'dict'`ï¼‰ï¼Œæ”¯æŒ 7 ç§å–å€¼ï¼ˆè§ä¸‹æ–¹è¯¦ç»†è¯´æ˜ï¼‰ |
| `into`     | æŒ‡å®šè¿”å›çš„æ˜ å°„ç±»å‹ï¼ˆé»˜è®¤ `dict`ï¼‰ï¼Œæ”¯æŒ `OrderedDict`ã€`defaultdict` ç­‰    |
| `index`    | æ˜¯å¦åŒ…å«ç´¢å¼•ä¿¡æ¯ï¼ˆé»˜è®¤ `True`ï¼‰ï¼Œä»… `orient='split'/'tight'` æ—¶å¯è®¾ä¸º `False` |


## å…³é”® `orient` æ ¼å¼è¯¦è§£ï¼ˆå«ç¤ºä¾‹ï¼‰
å…ˆå®šä¹‰åŸºç¡€ DataFrame ç”¨äºæ¼”ç¤ºï¼š
```python
import pandas as pd

df = pd.DataFrame({
    'col1': [1, 2],
    'col2': [0.5, 0.75]
}, index=['row1', 'row2'])  # ç´¢å¼•ä¸ºè¡Œå
print(df)
#       col1  col2
# row1     1  0.50
# row2     2  0.75
```

### 1. é»˜è®¤æ ¼å¼ï¼š`orient='dict'`ï¼ˆåˆ—â†’{ç´¢å¼•â†’å€¼}ï¼‰
æœ€å¸¸ç”¨æ ¼å¼ï¼Œå¤–å±‚é”®ä¸º**åˆ—å**ï¼Œå†…å±‚é”®ä¸º**ç´¢å¼•**ï¼Œå€¼ä¸ºå¯¹åº”å•å…ƒæ ¼æ•°æ®ã€‚
```python
df.to_dict()  # ç­‰ä»·äº df.to_dict('dict')
# è¾“å‡ºï¼š
# {'col1': {'row1': 1, 'row2': 2}, 'col2': {'row1': 0.5, 'row2': 0.75}}
```

### 2. `orient='list'`ï¼ˆåˆ—â†’[å€¼åˆ—è¡¨]ï¼‰
å¤–å±‚é”®ä¸º**åˆ—å**ï¼Œå€¼ä¸ºè¯¥åˆ—æ‰€æœ‰æ•°æ®ç»„æˆçš„åˆ—è¡¨ï¼ˆæŒ‰è¡Œé¡ºåºï¼‰ï¼Œå¿½ç•¥ç´¢å¼•ã€‚
```python
df.to_dict('list')
# è¾“å‡ºï¼š
# {'col1': [1, 2], 'col2': [0.5, 0.75]}
```

### 3. `orient='series'`ï¼ˆåˆ—â†’Series å¯¹è±¡ï¼‰
å¤–å±‚é”®ä¸º**åˆ—å**ï¼Œå€¼ä¸ºè¯¥åˆ—å¯¹åº”çš„ `Series`ï¼ˆä¿ç•™ç´¢å¼•ï¼‰ã€‚
```python
df.to_dict('series')
# è¾“å‡ºï¼š
# {'col1': row1    1
#          row2    2
# Name: col1, dtype: int64,
#  'col2': row1    0.50
#          row2    0.75
# Name: col2, dtype: float64}
```

### 4. `orient='split'`ï¼ˆæ‹†åˆ†ç´¢å¼•ã€åˆ—åã€æ•°æ®ï¼‰
è¿”å›åŒ…å« 3 ä¸ªé”®çš„å­—å…¸ï¼š`'index'`ï¼ˆç´¢å¼•åˆ—è¡¨ï¼‰ã€`'columns'`ï¼ˆåˆ—ååˆ—è¡¨ï¼‰ã€`'data'`ï¼ˆæ•°æ®äºŒç»´åˆ—è¡¨ï¼‰ã€‚
```python
df.to_dict('split')
# è¾“å‡ºï¼š
# {'index': ['row1', 'row2'],
#  'columns': ['col1', 'col2'],
#  'data': [[1, 0.5], [2, 0.75]]}

# ä¸åŒ…å«ç´¢å¼•ï¼ˆä»… split/tight æ”¯æŒï¼‰
df.to_dict('split', index=False)
# è¾“å‡ºï¼š{'columns': ['col1', 'col2'], 'data': [[1, 0.5], [2, 0.75]]}
```

### 5. `orient='tight'`ï¼ˆæ‹†åˆ†+ç´¢å¼•/åˆ—åçš„åç§°ï¼‰
åœ¨ `split` åŸºç¡€ä¸Šï¼Œé¢å¤–åŒ…å« `'index_names'`ï¼ˆç´¢å¼•çš„åç§°ï¼‰å’Œ `'column_names'`ï¼ˆåˆ—çš„åç§°ï¼‰ï¼Œé€‚åˆä¿ç•™å®Œæ•´å…ƒä¿¡æ¯ã€‚
```python
df.to_dict('tight')
# è¾“å‡ºï¼š
# {'index': ['row1', 'row2'],
#  'columns': ['col1', 'col2'],
#  'data': [[1, 0.5], [2, 0.75]],
#  'index_names': [None],  # ç´¢å¼•æ— åç§°æ—¶ä¸º None
#  'column_names': [None]} # åˆ—æ— åç§°æ—¶ä¸º None
```

### 6. `orient='records'`ï¼ˆè¡Œâ†’å­—å…¸åˆ—è¡¨ï¼‰
è¿”å›åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå¯¹åº”ä¸€è¡Œæ•°æ®ï¼ˆé”®ä¸ºåˆ—åï¼Œå€¼ä¸ºå•å…ƒæ ¼æ•°æ®ï¼‰ï¼Œé€‚åˆæ‰¹é‡å¤„ç†å•è¡Œæ•°æ®ã€‚
```python
df.to_dict('records')
# è¾“å‡ºï¼š
# [{'col1': 1, 'col2': 0.5}, {'col1': 2, 'col2': 0.75}]
```

### 7. `orient='index'`ï¼ˆç´¢å¼•â†’{åˆ—åâ†’å€¼}ï¼‰
ä¸é»˜è®¤æ ¼å¼ç›¸åï¼Œå¤–å±‚é”®ä¸º**ç´¢å¼•**ï¼Œå†…å±‚é”®ä¸º**åˆ—å**ï¼Œå€¼ä¸ºå¯¹åº”å•å…ƒæ ¼æ•°æ®ã€‚
```python
df.to_dict('index')
# è¾“å‡ºï¼š
# {'row1': {'col1': 1, 'col2': 0.5}, 'row2': {'col1': 2, 'col2': 0.75}}
```


## `into` å‚æ•°ï¼šè‡ªå®šä¹‰æ˜ å°„ç±»å‹
é»˜è®¤è¿”å› `dict`ï¼Œå¯æŒ‡å®šå…¶ä»–æ˜ å°„ç±»å‹ï¼ˆå¦‚ `OrderedDict`ã€`defaultdict`ï¼‰ï¼š

### ç¤ºä¾‹ 1ï¼šOrderedDictï¼ˆä¿ç•™é¡ºåºï¼‰
```python
from collections import OrderedDict

# è½¬æ¢åæ‰€æœ‰å±‚çº§å‡ä¸º OrderedDict
df.to_dict(into=OrderedDict)
# è¾“å‡ºï¼š
# OrderedDict([('col1', OrderedDict([('row1', 1), ('row2', 2)])),
#              ('col2', OrderedDict([('row1', 0.5), ('row2', 0.75)]))])
```

### ç¤ºä¾‹ 2ï¼šdefaultdictï¼ˆé»˜è®¤å€¼ç±»å‹ï¼‰
éœ€å…ˆåˆå§‹åŒ– `defaultdict`ï¼ŒæŒ‡å®šé»˜è®¤å€¼ç±»å‹ï¼ˆå¦‚ `list`ï¼‰ï¼š
```python
from collections import defaultdict

# åˆå§‹åŒ–é»˜è®¤å€¼ä¸º list çš„ defaultdict
dd = defaultdict(list)
# ç»“åˆ records æ ¼å¼ï¼Œæ¯ä¸ªå…ƒç´ ä¸º defaultdict
df.to_dict('records', into=dd)
# è¾“å‡ºï¼š
# [defaultdict(list, {'col1': 1, 'col2': 0.5}),
#  defaultdict(list, {'col1': 2, 'col2': 0.75})]
```


## æ ¸å¿ƒåœºæ™¯æ¨è
| åœºæ™¯éœ€æ±‚                  | æ¨è `orient` å–å€¼ |
|---------------------------|--------------------|
| æŒ‰åˆ—è·å–æ•°æ®ï¼ˆä¿ç•™ç´¢å¼•ï¼‰  | `'dict'`ï¼ˆé»˜è®¤ï¼‰   |
| æŒ‰åˆ—è·å–çº¯æ•°æ®åˆ—è¡¨        | `'list'`           |
| æ‰¹é‡å¤„ç†å•è¡Œæ•°æ®ï¼ˆå¦‚æ¥å£ï¼‰| `'records'`        |
| åˆ†ç¦»ç´¢å¼•ã€åˆ—åã€æ•°æ®      | `'split'`          |
| ä¿ç•™å®Œæ•´å…ƒä¿¡æ¯ï¼ˆå«åç§°ï¼‰  | `'tight'`          |
| æŒ‰è¡Œåï¼ˆç´¢å¼•ï¼‰è·å–æ•°æ®    | `'index'`          |