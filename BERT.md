## 理解masked_pos和gather部分

简单理解
![image.png](https://gitee.com/zhang-junjie123/picture/raw/master/image/20250126001452.png)

根据dim来确定index\[i]\[j]\[k]需要替换的input的索引位置和值来取数。

output tensor(
        
        [[[-0.2638, -0.2697, -0.2676,  ..., -0.0470,  0.1238, -0.1022],
         [-0.0230, -0.1123, -0.1675,  ...,  0.2341,  0.1663, -0.1417],
         [-0.0656,  0.1363, -0.2306,  ...,  0.1871,  0.2427, -0.3103],
         ...,
         [ 0.0928,  0.0774, -0.2640,  ...,  0.1677,  0.2437, -0.2477],
         [ 0.0275,  0.0732,  0.1370,  ...,  0.3576,  0.1043, -0.0741],
         [ 0.0077,  0.1234, -0.1685,  ...,  0.0302,  0.3829, -0.2297]],

        [[-0.2907, -0.2788, -0.1721,  ..., -0.0527,  0.1257, -0.0952],
         [-0.0811, -0.0734, -0.0020,  ...,  0.1969,  0.0458, -0.1397],
         [-0.0719,  0.1419, -0.1986,  ...,  0.1571,  0.2655, -0.3168],
         ...,
         [-0.0012,  0.0559, -0.2341,  ...,  0.1534,  0.2668, -0.2447],
         [-0.0892,  0.0862,  0.1588,  ...,  0.3334,  0.1197, -0.0706],
         [-0.0864,  0.1361, -0.2058,  ...,  0.0094,  0.3891, -0.1896]],

        [[-0.2164, -0.2601, -0.2071,  ..., -0.0712,  0.1490, -0.1406],
         [-0.0571, -0.0873, -0.0592,  ...,  0.2086,  0.0574, -0.1401],
         [-0.0280,  0.1772, -0.2403,  ...,  0.1715,  0.2632, -0.3087],
         ...,
         [ 0.0926,  0.0856, -0.2709,  ...,  0.1383,  0.2374, -0.2386],
         [ 0.0082,  0.0669,  0.1074,  ...,  0.3412,  0.1505, -0.0520],
         [ 0.0350,  0.1055, -0.1877,  ..., -0.0098,  0.4126, -0.2132]],

        [[-0.2670, -0.2469, -0.2542,  ..., -0.0264,  0.1523, -0.1117],
         [-0.1427, -0.1322, -0.0159,  ...,  0.1550,  0.0843, -0.1065],
         [ 0.0151,  0.1548, -0.3336,  ...,  0.1718,  0.0497, -0.2098],
         ...,
         [ 0.0714,  0.0968, -0.2951,  ...,  0.1326,  0.2712, -0.2640],
         [-0.0009,  0.0855,  0.1405,  ...,  0.3352,  0.1292, -0.0653],
         [-0.0095,  0.1270, -0.2007,  ...,  0.0171,  0.3921, -0.2228]],

        [[-0.2365, -0.2846, -0.2683,  ..., -0.0374,  0.1247, -0.0640],
         [ 0.1123, -0.0846,  0.0882,  ...,  0.1819,  0.3086, -0.0771],
         [ 0.0199, -0.0343, -0.3383,  ..., -0.0204,  0.1098, -0.3452],
         ...,
         [ 0.0855,  0.0750, -0.2782,  ...,  0.1289,  0.2489, -0.2264],
         [ 0.0354,  0.0792,  0.1823,  ...,  0.3229,  0.0942, -0.0344],
         [ 0.0060,  0.1355, -0.2080,  ..., -0.0102,  0.3608, -0.1821]],

        [[-0.2460, -0.2894, -0.2483,  ..., -0.0453,  0.1645, -0.1205],
         [ 0.0917, -0.0969,  0.0493,  ...,  0.1637,  0.3303, -0.1153],
         [-0.2320,  0.0833, -0.2960,  ...,  0.1312,  0.1691,  0.0017],
         ...,
         [ 0.0721,  0.0655, -0.2583,  ...,  0.1269,  0.2830, -0.2649],
         [-0.0026,  0.0822,  0.1664,  ...,  0.3317,  0.1379, -0.0841],
         [-0.0025,  0.1248, -0.2135,  ..., -0.0135,  0.3926, -0.2270]]])
masked_pos tensor(
        
        [[[ 1,  1,  1,  ...,  1,  1,  1],
         [ 0,  0,  0,  ...,  0,  0,  0],
         [ 0,  0,  0,  ...,  0,  0,  0],
         [ 0,  0,  0,  ...,  0,  0,  0],
         [ 0,  0,  0,  ...,  0,  0,  0]],

        [[13, 13, 13,  ..., 13, 13, 13],
         [ 6,  6,  6,  ...,  6,  6,  6],
         [ 0,  0,  0,  ...,  0,  0,  0],
         [ 0,  0,  0,  ...,  0,  0,  0],
         [ 0,  0,  0,  ...,  0,  0,  0]],

        [[ 5,  5,  5,  ...,  5,  5,  5],
         [ 0,  0,  0,  ...,  0,  0,  0],
         [ 0,  0,  0,  ...,  0,  0,  0],
         [ 0,  0,  0,  ...,  0,  0,  0],
         [ 0,  0,  0,  ...,  0,  0,  0]],

        [[ 5,  5,  5,  ...,  5,  5,  5],
         [ 1,  1,  1,  ...,  1,  1,  1],
         [ 4,  4,  4,  ...,  4,  4,  4],
         [ 0,  0,  0,  ...,  0,  0,  0],
         [ 0,  0,  0,  ...,  0,  0,  0]],

        [[ 7,  7,  7,  ...,  7,  7,  7],
         [ 5,  5,  5,  ...,  5,  5,  5],
         [ 2,  2,  2,  ...,  2,  2,  2],
         [ 0,  0,  0,  ...,  0,  0,  0],
         [ 0,  0,  0,  ...,  0,  0,  0]],

        [[12, 12, 12,  ..., 12, 12, 12],
         [ 3,  3,  3,  ...,  3,  3,  3],
         [ 4,  4,  4,  ...,  4,  4,  4],
         [ 0,  0,  0,  ...,  0,  0,  0],
         [ 0,  0,  0,  ...,  0,  0,  0]]])
h_masked tensor(
        
        [[[-0.0230, -0.1123, -0.1675,  ...,  0.2341,  0.1663, -0.1417],
         [-0.2638, -0.2697, -0.2676,  ..., -0.0470,  0.1238, -0.1022],
         [-0.2638, -0.2697, -0.2676,  ..., -0.0470,  0.1238, -0.1022],
         [-0.2638, -0.2697, -0.2676,  ..., -0.0470,  0.1238, -0.1022],
         [-0.2638, -0.2697, -0.2676,  ..., -0.0470,  0.1238, -0.1022]],

        [[-0.2278, -0.3280,  0.0210,  ..., -0.0379,  0.1855, -0.3204],
         [-0.2164, -0.2788,  0.0415,  ...,  0.0459,  0.1987, -0.2039],
         [-0.2907, -0.2788, -0.1721,  ..., -0.0527,  0.1257, -0.0952],
         [-0.2907, -0.2788, -0.1721,  ..., -0.0527,  0.1257, -0.0952],
         [-0.2907, -0.2788, -0.1721,  ..., -0.0527,  0.1257, -0.0952]],

        [[-0.0228, -0.1878,  0.0661,  ...,  0.0404,  0.0286,  0.1269],
         [-0.2164, -0.2601, -0.2071,  ..., -0.0712,  0.1490, -0.1406],
         [-0.2164, -0.2601, -0.2071,  ..., -0.0712,  0.1490, -0.1406],
         [-0.2164, -0.2601, -0.2071,  ..., -0.0712,  0.1490, -0.1406],
         [-0.2164, -0.2601, -0.2071,  ..., -0.0712,  0.1490, -0.1406]],

        [[-0.1617,  0.0340, -0.2801,  ..., -0.0173,  0.0619,  0.1040],
         [-0.1427, -0.1322, -0.0159,  ...,  0.1550,  0.0843, -0.1065],
         [-0.3973, -0.1957,  0.0058,  ..., -0.0112,  0.0810, -0.2982],
         [-0.2670, -0.2469, -0.2542,  ..., -0.0264,  0.1523, -0.1117],
         [-0.2670, -0.2469, -0.2542,  ..., -0.0264,  0.1523, -0.1117]],

        [[-0.0983, -0.1052, -0.3126,  ..., -0.0947, -0.0915, -0.2215],
         [ 0.1555,  0.1279, -0.0978,  ..., -0.0953,  0.0146,  0.0331],
         [ 0.0199, -0.0343, -0.3383,  ..., -0.0204,  0.1098, -0.3452],
         [-0.2365, -0.2846, -0.2683,  ..., -0.0374,  0.1247, -0.0640],
         [-0.2365, -0.2846, -0.2683,  ..., -0.0374,  0.1247, -0.0640]],

        [[-0.0744, -0.2337,  0.0716,  ..., -0.0092,  0.3740, -0.1798],
         [ 0.0925,  0.0363, -0.0610,  ...,  0.0936,  0.3631, -0.3247],
         [-0.4106, -0.2068,  0.0061,  ..., -0.0358,  0.0911, -0.3239],
         [-0.2460, -0.2894, -0.2483,  ..., -0.0453,  0.1645, -0.1205],
         [-0.2460, -0.2894, -0.2483,  ..., -0.0453,  0.1645, -0.1205]]],
       grad_fn=<GatherBackward0>)