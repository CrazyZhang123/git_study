〇. 前言
-----

在一个多月前，针对有同学关于矩阵求导中分子布局、分母布局**两者的区别**的疑问，我写了如下的这篇答案。

[矩阵求导中布局约定，两者布局的意义是什么?146 赞同 · 15 评论回答![](https://pic3.zhimg.com/v2-0d149ee0c5cd6a972e79fc0f07a553d6_180x120.jpg)](https://www.zhihu.com/question/352174717/answer/1436808747)

虽然这篇答案给出了几个结论，但是写的没有很严谨，并没有说明**矩阵求导**的**本质**与**分子布局**、**分母布局**的**本质**。

所以，在接下来这篇文章中，我将**更严谨**地说明**矩阵求导**的本质与**分子布局**、**分母布局**的**本质**。希望对**初学的同学、想理解本质的同学**提供一些帮助。

_**注1**：看懂本文只需了解本科阶段高等数学的**偏导**如何求、本科阶段[线性代数](https://zhida.zhihu.com/search?content_id=146747924&content_type=Article&match_order=1&q=%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0&zhida_source=entity)的**矩阵**的定义，**无需**任何其他知识。_

_**注2**：本文若无特殊说明，则[约定向量](https://zhida.zhihu.com/search?content_id=146747924&content_type=Article&match_order=1&q=%E7%BA%A6%E5%AE%9A%E5%90%91%E9%87%8F&zhida_source=entity)均为**列向量，**如_$\pmb{x}=[x_1,x_2,\cdots,x_n]^T$

_**注3**：本文仅考虑**实数，**不考虑**复数。**_

一. 函数与标量、向量、矩阵[\[1\]](#ref_1)
-----------------------------

考虑一个函数

$\text{function}(\text{input})$

针对$\text{function}$的类型、$\text{input}$ 的类型，我们可以将这个函数 $\text{function}$ 分为不同的种类。

**1、** $\text{function}$是一个**标量**

我们称 $\text{function}$ 是一个**实值标量函数。**用细体小写字母 f 表示。

**1.1** input\\text{input}\\text{input} 是一个**标量**

我们称 function\\text{function}\\text{function} 的**变元**是**标量。**用细体小写字母 xxx 表示。

**例1：**

(e.g.1)f(x)\=x+2f(x)=x+2 \\\\\\\\ \\tag{e.g.1}f(x)=x+2 \\\\\\\\ \\tag{e.g.1}

**1.2** input\\text{input}\\text{input} 是一个**向量**

我们称 function\\text{function}\\text{function} 的**变元**是**向量。**用**粗体**小写字母 xx\\pmb{x}\\pmb{x} 表示。

**例2：**设 xx\=\[x1,x2,x3\]T\\pmb{x}=\[x\_1,x\_2,x\_3\]^T\\pmb{x}=\[x\_1,x\_2,x\_3\]^T

(e.g.2)f(xx)\=a1x12+a2x22+a3x32+a4x1x2f(\\pmb{x})=a\_1x\_1^2+a\_2x\_2^2+a\_3x\_3^2+a\_4x\_1x\_2 \\\\\\\\ \\tag{e.g.2}f(\\pmb{x})=a\_1x\_1^2+a\_2x\_2^2+a\_3x\_3^2+a\_4x\_1x\_2 \\\\\\\\ \\tag{e.g.2}

**1.3** input\\text{input}\\text{input} 是一个**矩阵**

我们称 function\\text{function}\\text{function} 的**变元**是**矩阵。**用**粗体**大写字母 XX\\pmb{X}\\pmb{X} 表示。

**例3：**设 XX3×2\=(xij)i\=1,j\=13,2\\pmb{X}\_{3\\times 2}=(x\_{ij})\_{i=1,j=1}^{3,2}\\pmb{X}\_{3\\times 2}=(x\_{ij})\_{i=1,j=1}^{3,2}

(e.g.3)f(XX)\=a1x112+a2x122+a3x212+a4x222+a5x312+a6x322f(\\pmb{X})=a\_1x\_{11}^2+a\_2x\_{12}^2+a\_3x\_{21}^2+a\_4x\_{22}^2+a\_5x\_{31}^2+a\_6x\_{32}^2 \\\\\\\\ \\tag{e.g.3}f(\\pmb{X})=a\_1x\_{11}^2+a\_2x\_{12}^2+a\_3x\_{21}^2+a\_4x\_{22}^2+a\_5x\_{31}^2+a\_6x\_{32}^2 \\\\\\\\ \\tag{e.g.3}

**2、**function\\text{function}\\text{function} 是一个**向量**

我们称 function\\text{function}\\text{function} 是一个**实向量函数** 。用**粗体**小写字母 ff\\pmb{f}\\pmb{f} 表示。

**含义**： ff\\pmb{f}\\pmb{f} 是由若干个 fff 组成的一个**向量**。

同样地，变元分三种：**标量、向量、矩阵**。这里的符号仍与上面相同。

**2.1 [标量变元](https://zhida.zhihu.com/search?content_id=146747924&content_type=Article&match_order=1&q=%E6%A0%87%E9%87%8F%E5%8F%98%E5%85%83&zhida_source=entity)**

**例4：**

(e.g.4)ff3×1(x)\=\[f1(x)f2(x)f3(x)\]\=\[x+12x+13x2+1\]\\pmb{f}\_{3\\times1}(x)= \\left\[ \\matrix{ f\_1(x)\\\\ f\_2(x)\\\\ f\_3(x)\\\\ } \\right\] = \\left\[ \\matrix{ x+1\\\\ 2x+1\\\\ 3x^2+1 } \\right\] \\\\\\\\ \\tag{e.g.4}\\pmb{f}\_{3\\times1}(x)= \\left\[ \\matrix{ f\_1(x)\\\\ f\_2(x)\\\\ f\_3(x)\\\\ } \\right\] = \\left\[ \\matrix{ x+1\\\\ 2x+1\\\\ 3x^2+1 } \\right\] \\\\\\\\ \\tag{e.g.4}

**2.2 向量变元**

**例5：**设 xx\=\[x1,x2,x3\]T\\pmb{x}=\[x\_1,x\_2,x\_3\]^T\\pmb{x}=\[x\_1,x\_2,x\_3\]^T

(e.g.5)ff3×1(xx)\=\[f1(xx)f2(xx)f3(xx)\]\=\[x1+x2+x3x12+2x2+2x3x1x2+x2+x3\]\\pmb{f}\_{3\\times1}(\\pmb{x})= \\left\[ \\matrix{ f\_1(\\pmb{x})\\\\ f\_2(\\pmb{x})\\\\ f\_3(\\pmb{x})\\\\ } \\right\] = \\left\[ \\matrix{ x\_{1}+x\_{2}+x\_{3}\\\\ x\_{1}^2+2x\_{2}+2x\_{3}\\\\ x\_{1}x\_{2}+x\_{2}+x\_{3} } \\right\] \\\\\\\\ \\tag{e.g.5}\\pmb{f}\_{3\\times1}(\\pmb{x})= \\left\[ \\matrix{ f\_1(\\pmb{x})\\\\ f\_2(\\pmb{x})\\\\ f\_3(\\pmb{x})\\\\ } \\right\] = \\left\[ \\matrix{ x\_{1}+x\_{2}+x\_{3}\\\\ x\_{1}^2+2x\_{2}+2x\_{3}\\\\ x\_{1}x\_{2}+x\_{2}+x\_{3} } \\right\] \\\\\\\\ \\tag{e.g.5}

**2.3 矩阵变元**

**例6：**设 XX3×2\=(xij)i\=1,j\=13,2\\pmb{X}\_{3\\times 2}=(x\_{ij})\_{i=1,j=1}^{3,2}\\pmb{X}\_{3\\times 2}=(x\_{ij})\_{i=1,j=1}^{3,2}

(e.g.6)ff3×1(XX)\=\[f1(XX)f2(XX)f3(XX)\]\=\[x11+x12+x21+x22+x31+x32x11+x12+x21+x22+x31+x32+x11x122x11+x12+x21+x22+x31+x32+x11x12\]\\pmb{f}\_{3\\times1}(\\pmb{X})= \\left\[ \\matrix{ f\_1(\\pmb{X})\\\\ f\_2(\\pmb{X})\\\\ f\_3(\\pmb{X})\\\\ } \\right\] = \\left\[ \\matrix{ x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32}\\\\ x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32}+x\_{11}x\_{12}\\\\ 2x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32}+x\_{11}x\_{12} } \\right\] \\\\\\\\ \\tag{e.g.6}\\pmb{f}\_{3\\times1}(\\pmb{X})= \\left\[ \\matrix{ f\_1(\\pmb{X})\\\\ f\_2(\\pmb{X})\\\\ f\_3(\\pmb{X})\\\\ } \\right\] = \\left\[ \\matrix{ x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32}\\\\ x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32}+x\_{11}x\_{12}\\\\ 2x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32}+x\_{11}x\_{12} } \\right\] \\\\\\\\ \\tag{e.g.6}

**3、**function\\text{function}\\text{function} 是一个**矩阵**

我们称 function\\text{function}\\text{function} 是一个**实矩阵函数** 。用**粗体**大写字母 FF\\pmb{F}\\pmb{F} 表示。

**含义**： FF\\pmb{F}\\pmb{F} 是由若干个 fff 组成的一个**矩阵**。

同样地，变元分三种：**标量、向量、矩阵**。这里的符号仍与上面相同。

**3.1 标量变元**

**例7：**

(e.g.7)FF3×2(x)\=\[f11(x)f12(x)f21(x)f22(x)f31(x)f32(x)\]\=\[x+12x+2x2+12x2+1x3+12x3+1\]\\pmb{F}\_{3\\times2}(x)= \\left\[ \\matrix{ f\_{11}(x) & f\_{12}(x)\\\\ f\_{21}(x) & f\_{22}(x)\\\\ f\_{31}(x) & f\_{32}(x)\\\\ } \\right\] = \\left\[ \\matrix{ x+1 & 2x+2\\\\ x^2+1 & 2x^2+1\\\\ x^3+1 & 2x^3+1 } \\right\] \\\\\\\\ \\tag{e.g.7}\\pmb{F}\_{3\\times2}(x)= \\left\[ \\matrix{ f\_{11}(x) & f\_{12}(x)\\\\ f\_{21}(x) & f\_{22}(x)\\\\ f\_{31}(x) & f\_{32}(x)\\\\ } \\right\] = \\left\[ \\matrix{ x+1 & 2x+2\\\\ x^2+1 & 2x^2+1\\\\ x^3+1 & 2x^3+1 } \\right\] \\\\\\\\ \\tag{e.g.7}

**3.2 向量变元**

**例8：**设 xx\=\[x1,x2,x3\]T\\pmb{x}=\[x\_1,x\_2,x\_3\]^T\\pmb{x}=\[x\_1,x\_2,x\_3\]^T

(e.g.8)FF3×2(xx)\=\[f11(xx)f12(xx)f21(xx)f22(xx)f31(xx)f32(xx)\]\=\[2x1+x2+x32x1+2x2+x32x1+2x2+x3x1+2x2+x32x1+x2+2x3x1+2x2+2x3\]\\pmb{F}\_{3\\times2}(\\pmb{x})= \\left\[ \\matrix{ f\_{11}(\\pmb{x}) & f\_{12}(\\pmb{x})\\\\ f\_{21}(\\pmb{x}) & f\_{22}(\\pmb{x})\\\\ f\_{31}(\\pmb{x}) & f\_{32}(\\pmb{x})\\\\ } \\right\] = \\left\[ \\matrix{ 2x\_{1}+x\_{2}+x\_{3} & 2x\_{1}+2x\_{2}+x\_{3} \\\\ 2x\_{1}+2x\_{2}+x\_{3} & x\_{1}+2x\_{2}+x\_{3} & \\\\ 2x\_{1}+x\_{2}+2x\_{3} & x\_{1}+2x\_{2}+2x\_{3} & } \\right\] \\\\\\\\ \\tag{e.g.8}\\pmb{F}\_{3\\times2}(\\pmb{x})= \\left\[ \\matrix{ f\_{11}(\\pmb{x}) & f\_{12}(\\pmb{x})\\\\ f\_{21}(\\pmb{x}) & f\_{22}(\\pmb{x})\\\\ f\_{31}(\\pmb{x}) & f\_{32}(\\pmb{x})\\\\ } \\right\] = \\left\[ \\matrix{ 2x\_{1}+x\_{2}+x\_{3} & 2x\_{1}+2x\_{2}+x\_{3} \\\\ 2x\_{1}+2x\_{2}+x\_{3} & x\_{1}+2x\_{2}+x\_{3} & \\\\ 2x\_{1}+x\_{2}+2x\_{3} & x\_{1}+2x\_{2}+2x\_{3} & } \\right\] \\\\\\\\ \\tag{e.g.8}

**3.3 [矩阵变元](https://zhida.zhihu.com/search?content_id=146747924&content_type=Article&match_order=2&q=%E7%9F%A9%E9%98%B5%E5%8F%98%E5%85%83&zhida_source=entity)**

**例9：**设 XX3×2\=(xij)i\=1,j\=13,2\\pmb{X}\_{3\\times 2}=(x\_{ij})\_{i=1,j=1}^{3,2}\\pmb{X}\_{3\\times 2}=(x\_{ij})\_{i=1,j=1}^{3,2}

(e.g.9)FF3×2(XX)\=\[f11(XX)f12(XX)f21(XX)f22(XX)f31(XX)f32(XX)\]\=\[x11+x12+x21+x22+x31+x322x11+x12+x21+x22+x31+x323x11+x12+x21+x22+x31+x324x11+x12+x21+x22+x31+x325x11+x12+x21+x22+x31+x326x11+x12+x21+x22+x31+x32\]\\begin{align\*} \\pmb{F}\_{3\\times2}(\\pmb{X})&= \\left\[ \\matrix{ f\_{11}(\\pmb{X}) & f\_{12}(\\pmb{X})\\\\ f\_{21}(\\pmb{X}) & f\_{22}(\\pmb{X})\\\\ f\_{31}(\\pmb{X}) & f\_{32}(\\pmb{X})\\\\ } \\right\]\\\\\\\\ &= \\left\[ \\matrix{ x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32} & 2x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32}\\\\ 3x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32} & 4x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32}\\\\ 5x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32} & 6x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32} } \\right\] \\end{align\*} \\\\\\\\ \\tag{e.g.9}\\begin{align\*} \\pmb{F}\_{3\\times2}(\\pmb{X})&= \\left\[ \\matrix{ f\_{11}(\\pmb{X}) & f\_{12}(\\pmb{X})\\\\ f\_{21}(\\pmb{X}) & f\_{22}(\\pmb{X})\\\\ f\_{31}(\\pmb{X}) & f\_{32}(\\pmb{X})\\\\ } \\right\]\\\\\\\\ &= \\left\[ \\matrix{ x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32} & 2x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32}\\\\ 3x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32} & 4x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32}\\\\ 5x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32} & 6x\_{11}+x\_{12}+x\_{21}+x\_{22}+x\_{31}+x\_{32} } \\right\] \\end{align\*} \\\\\\\\ \\tag{e.g.9}

**4、总结**

![](https://pic3.zhimg.com/v2-c1eca9e7a8da97ecbcee847db71b4488_1440w.jpg)

函数与标量、向量、矩阵

二. 矩阵求导的本质
----------

我们在高等数学[\[2\]](#ref_2)中学过，对于一个[多元函数](https://zhida.zhihu.com/search?content_id=146747924&content_type=Article&match_order=1&q=%E5%A4%9A%E5%85%83%E5%87%BD%E6%95%B0&zhida_source=entity)

**例10：**

(e.g.10)f(x1,x2,x3)\=x12+x1x2+x2x3f(x\_1,x\_2,x\_3)=x\_1^2+x\_1x\_2+x\_2x\_3 \\\\\\\\ \\tag{e.g.10}f(x\_1,x\_2,x\_3)=x\_1^2+x\_1x\_2+x\_2x\_3 \\\\\\\\ \\tag{e.g.10}

我们可以将 fff 对 x1,x2,x3x\_1,x\_2,x\_3x\_1,x\_2,x\_3 的**偏导**分别求出来**，即：**

{∂f∂x1\=2x1+x2∂f∂x2\=x1+x3∂f∂x3\=x2\\left\\{ \\begin{align\*} \\frac{\\partial f}{\\partial x\_1} & = 2x\_1+x\_2 \\\\\\\\ \\frac{\\partial f}{\\partial x\_2} & = x\_1+x\_3 \\\\\\\\ \\frac{\\partial f}{\\partial x\_3} & = x\_2 \\end{align\*} \\right. \\\\\\\\\\left\\{ \\begin{align\*} \\frac{\\partial f}{\\partial x\_1} & = 2x\_1+x\_2 \\\\\\\\ \\frac{\\partial f}{\\partial x\_2} & = x\_1+x\_3 \\\\\\\\ \\frac{\\partial f}{\\partial x\_3} & = x\_2 \\end{align\*} \\right. \\\\\\\\

矩阵求导也是一样的，**本质就是** function\\text{function}\\text{function} 中的**每个** fff **分别对变元中的每个元素逐个求偏导，只不过写成了向量、矩阵形式而已。**

对于 (e.g.10)(e.g.10)(e.g.10) ，我们把得出的3个结果写成**列向量**形式：

(1)∂f(xx)∂xx3×1\=\[∂f∂x1∂f∂x2∂f∂x3\]\=\[2x1+x2x1+x3x2\]\\frac{\\partial f(\\pmb{x})}{\\partial \\pmb{x}\_{3\\times1}}= \\left\[ \\matrix{ \\frac{\\partial f}{\\partial x\_1}\\\\ \\frac{\\partial f}{\\partial x\_2}\\\\ \\frac{\\partial f}{\\partial x\_3}\\\\ } \\right\] = \\left\[ \\matrix{ 2x\_1+x\_2\\\\ x\_1+x\_3\\\\ x\_2 } \\right\] \\\\\\\\ \\tag{1}\\frac{\\partial f(\\pmb{x})}{\\partial \\pmb{x}\_{3\\times1}}= \\left\[ \\matrix{ \\frac{\\partial f}{\\partial x\_1}\\\\ \\frac{\\partial f}{\\partial x\_2}\\\\ \\frac{\\partial f}{\\partial x\_3}\\\\ } \\right\] = \\left\[ \\matrix{ 2x\_1+x\_2\\\\ x\_1+x\_3\\\\ x\_2 } \\right\] \\\\\\\\ \\tag{1}

一个矩阵求导**以列向量形式展开**的雏形就出现了。

当然我们也可以以**行向量形式展开：**

(2)∂f(xx)∂xx3×1T\=\[∂f∂x1,∂f∂x2,∂f∂x3\]\=\[2x1+x2,x1+x3,x2\]\\frac{\\partial f(\\pmb{x})}{\\partial \\pmb{x}\_{3\\times1}^T}= \\left\[ \\frac{\\partial f}{\\partial x\_1}, \\frac{\\partial f}{\\partial x\_2}, \\frac{\\partial f}{\\partial x\_3} \\right\] = \\left\[ 2x\_1+x\_2, x\_1+x\_3, x\_2 \\right\] \\\\\\\\ \\tag{2}\\frac{\\partial f(\\pmb{x})}{\\partial \\pmb{x}\_{3\\times1}^T}= \\left\[ \\frac{\\partial f}{\\partial x\_1}, \\frac{\\partial f}{\\partial x\_2}, \\frac{\\partial f}{\\partial x\_3} \\right\] = \\left\[ 2x\_1+x\_2, x\_1+x\_3, x\_2 \\right\] \\\\\\\\ \\tag{2}

所以，如果 function\\text{function}\\text{function} 中有 mmm 个 fff ，变元中有 nnn 个元素，那么，每个 fff 对变元中的每个元素逐个求偏导后，我们就会产生 m×nm \\times nm \\times n 个结果。

**这就是矩阵求导的本质。**

至于这 m×nm \\times nm \\times n 个结果的布局，是写成行向量，还是写成列向量，还是写成矩阵，就是我们接下来要讨论的事情。

三. 矩阵求导结果的布局
------------

**不严谨**地说，从**直观**上看：

**分子布局**，就是分子是**列向量**形式，分母是**行向量**形式，如 (2)(2)(2) 式。如果这里的 function\\text{function}\\text{function} 是**实向量函数** ff2×1\\pmb{f}\_{2\\times 1}\\pmb{f}\_{2\\times 1} 的话，结果就是 2×32 \\times 32 \\times 3 的矩阵了：

(3)∂ff2×1(xx)∂xx3×1T\=\[∂f1∂x1∂f1∂x2∂f1∂x3∂f2∂x1∂f2∂x2∂f2∂x3\]2×3\\frac{\\partial \\pmb{f}\_{2\\times1}(\\pmb{x})}{\\partial \\pmb{x}^T\_{3\\times1}}= \\left\[ \\matrix{ \\frac{\\partial f\_1}{\\partial x\_1}& \\frac{\\partial f\_1}{\\partial x\_2}& \\frac{\\partial f\_1}{\\partial x\_3}\\\\ \\frac{\\partial f\_2}{\\partial x\_1}& \\frac{\\partial f\_2}{\\partial x\_2}& \\frac{\\partial f\_2}{\\partial x\_3}} \\right\]\_{2\\times 3} \\\\\\\\ \\tag{3}\\frac{\\partial \\pmb{f}\_{2\\times1}(\\pmb{x})}{\\partial \\pmb{x}^T\_{3\\times1}}= \\left\[ \\matrix{ \\frac{\\partial f\_1}{\\partial x\_1}& \\frac{\\partial f\_1}{\\partial x\_2}& \\frac{\\partial f\_1}{\\partial x\_3}\\\\ \\frac{\\partial f\_2}{\\partial x\_1}& \\frac{\\partial f\_2}{\\partial x\_2}& \\frac{\\partial f\_2}{\\partial x\_3}} \\right\]\_{2\\times 3} \\\\\\\\ \\tag{3}

**分母布局**，就是分母是**列向量**形式，分子是**行向量**形式，如 (1)(1)(1) 式。如果这里的 function\\text{function}\\text{function} 是**实向量函数** ff2×1\\pmb{f}\_{2\\times 1}\\pmb{f}\_{2\\times 1} 的话，结果就是 3×23 \\times 23 \\times 2 的矩阵了：

(4)∂ff2×1T(xx)∂xx3×1\=\[∂f1∂x1∂f2∂x1∂f1∂x2∂f2∂x2∂f1∂x3∂f2∂x3\]3×2\\frac{\\partial \\pmb{f}^T\_{2\\times1}(\\pmb{x})}{\\partial \\pmb{x}\_{3\\times1}}= \\left\[ \\matrix{ \\frac{\\partial f\_1}{\\partial x\_1}& \\frac{\\partial f\_2}{\\partial x\_1} \\\\ \\frac{\\partial f\_1}{\\partial x\_2}& \\frac{\\partial f\_2}{\\partial x\_2} \\\\ \\frac{\\partial f\_1}{\\partial x\_3}& \\frac{\\partial f\_2}{\\partial x\_3} } \\right\]\_{3\\times 2} \\\\\\\\ \\tag{4}\\frac{\\partial \\pmb{f}^T\_{2\\times1}(\\pmb{x})}{\\partial \\pmb{x}\_{3\\times1}}= \\left\[ \\matrix{ \\frac{\\partial f\_1}{\\partial x\_1}& \\frac{\\partial f\_2}{\\partial x\_1} \\\\ \\frac{\\partial f\_1}{\\partial x\_2}& \\frac{\\partial f\_2}{\\partial x\_2} \\\\ \\frac{\\partial f\_1}{\\partial x\_3}& \\frac{\\partial f\_2}{\\partial x\_3} } \\right\]\_{3\\times 2} \\\\\\\\ \\tag{4}

直观上理解了之后，我们针对不同类型的 function\\text{function}\\text{function} ，不同类型的**变元**，给出**严谨**的布局说明。（这里不讨论标量变元的实值标量函数 f(x)f(x)f(x) ，因为结果就是一个元素嘛~）

**1、向量**变元的**实值标量**函数 f(xx)f(\\pmb{x})f(\\pmb{x}) , xx\=\[x1,x2,⋯,xn\]T\\pmb{x}=\[x\_1,x\_2,\\cdots,x\_n\]^T\\pmb{x}=\[x\_1,x\_2,\\cdots,x\_n\]^T

**1.1** **行向量偏导**形式（又称**[行偏导向量](https://zhida.zhihu.com/search?content_id=146747924&content_type=Article&match_order=1&q=%E8%A1%8C%E5%81%8F%E5%AF%BC%E5%90%91%E9%87%8F&zhida_source=entity)**形式）[\[3\]](#ref_3)

(5)Dxxf(xx)\=∂f(xx)∂xxT\=\[∂f∂x1,∂f∂x2,⋯,∂f∂xn\]\\text{D}\_{\\pmb{x}}f(\\pmb{x})= \\frac{\\partial f(\\pmb{x})}{\\partial \\pmb{x}^T}= \\left\[ \\frac{\\partial f}{\\partial x\_1}, \\frac{\\partial f}{\\partial x\_2}, \\cdots, \\frac{\\partial f}{\\partial x\_n} \\right\] \\\\\\\\ \\tag{5}\\text{D}\_{\\pmb{x}}f(\\pmb{x})= \\frac{\\partial f(\\pmb{x})}{\\partial \\pmb{x}^T}= \\left\[ \\frac{\\partial f}{\\partial x\_1}, \\frac{\\partial f}{\\partial x\_2}, \\cdots, \\frac{\\partial f}{\\partial x\_n} \\right\] \\\\\\\\ \\tag{5}

**1.2** **梯度向量**形式（又称**列向量偏导**形式、**列偏导向量**形式）[\[4\]](#ref_4)

(6)∇xxf(xx)\=∂f(xx)∂xx\=\[∂f∂x1,∂f∂x2,⋯,∂f∂xn\]T\\nabla\_{\\pmb{x}}f(\\pmb{x})= \\frac{\\partial f(\\pmb{x})}{\\partial \\pmb{x}}= \\left\[ \\frac{\\partial f}{\\partial x\_1}, \\frac{\\partial f}{\\partial x\_2}, \\cdots, \\frac{\\partial f}{\\partial x\_n} \\right\]^T \\\\\\\\ \\tag{6}\\nabla\_{\\pmb{x}}f(\\pmb{x})= \\frac{\\partial f(\\pmb{x})}{\\partial \\pmb{x}}= \\left\[ \\frac{\\partial f}{\\partial x\_1}, \\frac{\\partial f}{\\partial x\_2}, \\cdots, \\frac{\\partial f}{\\partial x\_n} \\right\]^T \\\\\\\\ \\tag{6}

这两种形式**互为转置**。

**2、矩阵**变元的**实值标量**函数 f(XX)f(\\pmb{X})f(\\pmb{X}) , XXm×n\=(xij)i\=1,j\=1m,n\\pmb{X}\_{m\\times n}=(x\_{ij})\_{i=1,j=1}^{m,n}\\pmb{X}\_{m\\times n}=(x\_{ij})\_{i=1,j=1}^{m,n}

先介绍一个符号 vec(XX)\\text{vec}(\\pmb{X})\\text{vec}(\\pmb{X}) ，作用是将矩阵 XX\\pmb{X}\\pmb{X} **按列堆栈**来向量化。

解释一下，vec(XX)\\text{vec}(\\pmb{X})\\text{vec}(\\pmb{X})就是把矩阵 XX\\pmb{X}\\pmb{X} 的第 111 列，第 222 列，直到第 nnn 列取出来，然后按顺序组成一个**列向量**，即：

(7)vec(XX)\=\[x11,x21,⋯,xm1,x12,x22,⋯,xm2,⋯,x1n,x2n,⋯,xmn\]T\\text{vec}({\\pmb{X})}= \\left\[ x\_{11},x\_{21},\\cdots,x\_{m1},x\_{12},x\_{22},\\cdots,x\_{m2},\\cdots,x\_{1n},x\_{2n},\\cdots,x\_{mn} \\right\]^T \\\\\\\\ \\tag{7}\\text{vec}({\\pmb{X})}= \\left\[ x\_{11},x\_{21},\\cdots,x\_{m1},x\_{12},x\_{22},\\cdots,x\_{m2},\\cdots,x\_{1n},x\_{2n},\\cdots,x\_{mn} \\right\]^T \\\\\\\\ \\tag{7}

**2.1 行向量偏导**形式（又称**行偏导向量**形式）[\[3\]](#ref_3)

即先把**矩阵**变元 XX\\pmb{X}\\pmb{X} 按 vec\\text{vec}\\text{vec} **向量化**，转换成**向量**变元，再对**该向量变元**使用 (5)(5)(5) 式：

(8)DvecXXf(XX)\=∂f(XX)∂vecT(XX)\=\[∂f∂x11,∂f∂x21,⋯,∂f∂xm1,∂f∂x12,∂f∂x22,⋯,∂f∂xm2,⋯,∂f∂x1n,∂f∂x2n,⋯,∂f∂xmn\]\\begin{align\*} \\text{D}\_{\\text{vec}\\pmb{X}}f(\\pmb{X})&= \\frac{\\partial f(\\pmb{X})}{\\partial \\text{vec}^T(\\pmb{X})} \\\\\\\\ &= \\left\[ \\frac{\\partial f}{\\partial x\_{11}},\\frac{\\partial f}{\\partial x\_{21}},\\cdots,\\frac{\\partial f}{\\partial x\_{m1}},\\frac{\\partial f}{\\partial x\_{12}},\\frac{\\partial f}{\\partial x\_{22}},\\cdots,\\frac{\\partial f}{\\partial x\_{m2}},\\cdots,\\frac{\\partial f} {\\partial x\_{1n}},\\frac{\\partial f}{\\partial x\_{2n}},\\cdots,\\frac{\\partial f}{\\partial x\_{mn}} \\right\] \\end{align\*} \\\\\\\\ \\tag{8}\\begin{align\*} \\text{D}\_{\\text{vec}\\pmb{X}}f(\\pmb{X})&= \\frac{\\partial f(\\pmb{X})}{\\partial \\text{vec}^T(\\pmb{X})} \\\\\\\\ &= \\left\[ \\frac{\\partial f}{\\partial x\_{11}},\\frac{\\partial f}{\\partial x\_{21}},\\cdots,\\frac{\\partial f}{\\partial x\_{m1}},\\frac{\\partial f}{\\partial x\_{12}},\\frac{\\partial f}{\\partial x\_{22}},\\cdots,\\frac{\\partial f}{\\partial x\_{m2}},\\cdots,\\frac{\\partial f} {\\partial x\_{1n}},\\frac{\\partial f}{\\partial x\_{2n}},\\cdots,\\frac{\\partial f}{\\partial x\_{mn}} \\right\] \\end{align\*} \\\\\\\\ \\tag{8}

**2.2** Jacobian\\text{Jacobian}\\text{Jacobian} **矩阵**形式[\[3\]](#ref_3)

即先把矩阵变元 XX\\pmb{X}\\pmb{X} 进行**转置**，再对**转置后**的**每个位置**的元素逐个求偏导，结果布局和**转置布局一样**。

(9)DXXf(XX)\=∂f(XX)∂XXm×nT\=\[∂f∂x11∂f∂x21⋯∂f∂xm1∂f∂x12∂f∂x22⋯∂f∂xm2⋮⋮⋮⋮∂f∂x1n∂f∂x2n⋯∂f∂xmn\]n×m\\begin{align\*} \\text{D}\_{\\pmb{X}}f(\\pmb{X})&= \\frac{\\partial f(\\pmb{X})}{\\partial \\pmb{X}^T\_{m\\times n}} \\\\\\\\ &= \\left\[ \\matrix{ \\frac{\\partial f}{\\partial x\_{11}}&\\frac{\\partial f}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f}{\\partial x\_{m1}} \\\\ \\frac{\\partial f}{\\partial x\_{12}}&\\frac{\\partial f}{\\partial x\_{22}}& \\cdots & \\frac{\\partial f}{\\partial x\_{m2}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f} {\\partial x\_{1n}}&\\frac{\\partial f}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f}{\\partial x\_{mn}} } \\right\]\_{n\\times m} \\end{align\*} \\\\\\\\ \\tag{9}\\begin{align\*} \\text{D}\_{\\pmb{X}}f(\\pmb{X})&= \\frac{\\partial f(\\pmb{X})}{\\partial \\pmb{X}^T\_{m\\times n}} \\\\\\\\ &= \\left\[ \\matrix{ \\frac{\\partial f}{\\partial x\_{11}}&\\frac{\\partial f}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f}{\\partial x\_{m1}} \\\\ \\frac{\\partial f}{\\partial x\_{12}}&\\frac{\\partial f}{\\partial x\_{22}}& \\cdots & \\frac{\\partial f}{\\partial x\_{m2}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f} {\\partial x\_{1n}}&\\frac{\\partial f}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f}{\\partial x\_{mn}} } \\right\]\_{n\\times m} \\end{align\*} \\\\\\\\ \\tag{9}

**2.3 [梯度向量](https://zhida.zhihu.com/search?content_id=146747924&content_type=Article&match_order=2&q=%E6%A2%AF%E5%BA%A6%E5%90%91%E9%87%8F&zhida_source=entity)**形式（又称**列向量偏导**形式、**列偏导向量**形式）[\[4\]](#ref_4)

即先把**矩阵**变元 XX\\pmb{X}\\pmb{X} 按 vec\\text{vec}\\text{vec} **[向量化](https://zhida.zhihu.com/search?content_id=146747924&content_type=Article&match_order=3&q=%E5%90%91%E9%87%8F%E5%8C%96&zhida_source=entity)**，转换成**向量**变元，再对**该变元**使用 (6)(6)(6) 式：

(10)∇vecXXf(XX)\=∂f(XX)∂vecXX\=\[∂f∂x11,∂f∂x21,⋯,∂f∂xm1,∂f∂x12,∂f∂x22,⋯,∂f∂xm2,⋯,∂f∂x1n,∂f∂x2n,⋯,∂f∂xmn\]T\\begin{align\*} \\nabla\_{\\text{vec}\\pmb{X}}f(\\pmb{X})&= \\frac{\\partial f(\\pmb{X})}{\\partial \\text{vec}\\pmb{X}} \\\\\\\\ &= \\left\[ \\frac{\\partial f}{\\partial x\_{11}},\\frac{\\partial f}{\\partial x\_{21}},\\cdots,\\frac{\\partial f}{\\partial x\_{m1}},\\frac{\\partial f}{\\partial x\_{12}},\\frac{\\partial f}{\\partial x\_{22}},\\cdots,\\frac{\\partial f}{\\partial x\_{m2}},\\cdots,\\frac{\\partial f} {\\partial x\_{1n}},\\frac{\\partial f}{\\partial x\_{2n}},\\cdots,\\frac{\\partial f}{\\partial x\_{mn}} \\right\]^T \\end{align\*} \\\\\\\\ \\tag{10}\\begin{align\*} \\nabla\_{\\text{vec}\\pmb{X}}f(\\pmb{X})&= \\frac{\\partial f(\\pmb{X})}{\\partial \\text{vec}\\pmb{X}} \\\\\\\\ &= \\left\[ \\frac{\\partial f}{\\partial x\_{11}},\\frac{\\partial f}{\\partial x\_{21}},\\cdots,\\frac{\\partial f}{\\partial x\_{m1}},\\frac{\\partial f}{\\partial x\_{12}},\\frac{\\partial f}{\\partial x\_{22}},\\cdots,\\frac{\\partial f}{\\partial x\_{m2}},\\cdots,\\frac{\\partial f} {\\partial x\_{1n}},\\frac{\\partial f}{\\partial x\_{2n}},\\cdots,\\frac{\\partial f}{\\partial x\_{mn}} \\right\]^T \\end{align\*} \\\\\\\\ \\tag{10}

**2.4 梯度矩阵**形式[\[4\]](#ref_4)

直接对原矩阵变元 XX\\pmb{X}\\pmb{X} 的**每个位置**的元素逐个求[偏导](https://zhida.zhihu.com/search?content_id=146747924&content_type=Article&match_order=14&q=%E5%81%8F%E5%AF%BC&zhida_source=entity)，结果布局和**原矩阵布局一样**。

(11)∇XXf(XX)\=∂f(XX)∂XXm×n\=\[∂f∂x11∂f∂x12⋯∂f∂x1n∂f∂x21∂f∂x22⋯∂f∂x2n⋮⋮⋮⋮∂f∂xm1∂f∂xm2⋯∂f∂xmn\]m×n\\begin{align\*} \\nabla\_{\\pmb{X}}f(\\pmb{X})&= \\frac{\\partial f(\\pmb{X})}{\\partial \\pmb{X}\_{m\\times n}} \\\\\\\\ &= \\left\[ \\matrix{ \\frac{\\partial f}{\\partial x\_{11}}&\\frac{\\partial f}{\\partial x\_{12}}&\\cdots&\\frac{\\partial f}{\\partial x\_{1n}} \\\\ \\frac{\\partial f}{\\partial x\_{21}}&\\frac{\\partial f}{\\partial x\_{22}}& \\cdots & \\frac{\\partial f}{\\partial x\_{2n}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f} {\\partial x\_{m1}}&\\frac{\\partial f}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f}{\\partial x\_{mn}} } \\right\]\_{m\\times n} \\end{align\*} \\\\\\\\ \\tag{11}\\begin{align\*} \\nabla\_{\\pmb{X}}f(\\pmb{X})&= \\frac{\\partial f(\\pmb{X})}{\\partial \\pmb{X}\_{m\\times n}} \\\\\\\\ &= \\left\[ \\matrix{ \\frac{\\partial f}{\\partial x\_{11}}&\\frac{\\partial f}{\\partial x\_{12}}&\\cdots&\\frac{\\partial f}{\\partial x\_{1n}} \\\\ \\frac{\\partial f}{\\partial x\_{21}}&\\frac{\\partial f}{\\partial x\_{22}}& \\cdots & \\frac{\\partial f}{\\partial x\_{2n}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f} {\\partial x\_{m1}}&\\frac{\\partial f}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f}{\\partial x\_{mn}} } \\right\]\_{m\\times n} \\end{align\*} \\\\\\\\ \\tag{11}

**2.5 一些发现**

**2.5.1 转置**

(8)(8)(8) 式与 (10)(10)(10) 式**[互为转置](https://zhida.zhihu.com/search?content_id=146747924&content_type=Article&match_order=2&q=%E4%BA%92%E4%B8%BA%E8%BD%AC%E7%BD%AE&zhida_source=entity)**； (9)(9)(9) 式与 (11)(11)(11) 式**互为转置**。

**2.5.2 相等**

当**矩阵**变元 XX\\pmb{X}\\pmb{X} 本身就是一个**列向量** xx\=\[x1,x2,⋯,xn\]T\\pmb{x}=\[x\_1,x\_2,\\cdots,x\_n\]^T\\pmb{x}=\[x\_1,x\_2,\\cdots,x\_n\]^T 时， (5)(5)(5) 式、 (8)(8)(8) 式、 (9)(9)(9) 式**相等；** (6)(6)(6) 式、 (10)(10)(10) 式、 (11)(11)(11) 式**相等；**当然，前三个式子与后三个式子**互为转置**。

这一发现说明，对于**向量**变元的**实值标量**函数 f(xx)f(\\pmb{x})f(\\pmb{x}) , xx\=\[x1,x2,⋯,xn\]T\\pmb{x}=\[x\_1,x\_2,\\cdots,x\_n\]^T\\pmb{x}=\[x\_1,x\_2,\\cdots,x\_n\]^T，结果布局本质上有两种形式，一种是 Jacobian\\text{Jacobian}\\text{Jacobian} 矩阵（**已经成[行向量](https://zhida.zhihu.com/search?content_id=146747924&content_type=Article&match_order=7&q=%E8%A1%8C%E5%90%91%E9%87%8F&zhida_source=entity)了**）形式，一种是**梯度**矩阵（**已经成列向量了**）形式。两种形式**互为转置**。

**3、矩阵**变元的**实矩阵**函数 FF(XX)\\pmb{F}(\\pmb{X})\\pmb{F}(\\pmb{X}) , XXm×n\=(xij)i\=1,j\=1m,n\\pmb{X}\_{m\\times n}=(x\_{ij})\_{i=1,j=1}^{m,n}\\pmb{X}\_{m\\times n}=(x\_{ij})\_{i=1,j=1}^{m,n}， FFp×q\=(fij)i\=1,j\=1p,q\\pmb{F}\_{p\\times q}=(f\_{ij})\_{i=1,j=1}^{p,q}\\pmb{F}\_{p\\times q}=(f\_{ij})\_{i=1,j=1}^{p,q}

**3.1** Jacobian\\text{Jacobian}\\text{Jacobian} **矩阵**形式[\[5\]](#ref_5)

即先把**矩阵**变元 XX\\pmb{X}\\pmb{X} 按 vec\\text{vec}\\text{vec}**向量化**，转换成**向量**变元：

(7)vec(XX)\=\[x11,x21,⋯,xm1,x12,x22,⋯,xm2,⋯,x1n,x2n,⋯,xmn\]T\\text{vec}({\\pmb{X})}= \\left\[ x\_{11},x\_{21},\\cdots,x\_{m1},x\_{12},x\_{22},\\cdots,x\_{m2},\\cdots,x\_{1n},x\_{2n},\\cdots,x\_{mn} \\right\]^T \\\\\\\\ \\tag{7}\\text{vec}({\\pmb{X})}= \\left\[ x\_{11},x\_{21},\\cdots,x\_{m1},x\_{12},x\_{22},\\cdots,x\_{m2},\\cdots,x\_{1n},x\_{2n},\\cdots,x\_{mn} \\right\]^T \\\\\\\\ \\tag{7}

再把**实矩阵**函数 FF\\pmb{F}\\pmb{F} 按vec\\text{vec}\\text{vec}**向量化**，转换成**实向量**函数：

(12)vec(FF(XX))\=\[f11(XX),f21(XX),⋯,fp1(XX),f12(XX),f22(XX),⋯,fp2(XX),⋯,f1q(XX),f2q(XX),⋯,fpq(XX)\]T\\text{vec}({\\pmb{F}(\\pmb{X}))}\\\\= \\left\[ f\_{11}(\\pmb{X}),f\_{21}(\\pmb{X}),\\cdots,f\_{p1}(\\pmb{X}),f\_{12}(\\pmb{X}),f\_{22}(\\pmb{X}),\\cdots,f\_{p2}(\\pmb{X}),\\cdots,f\_{1q}(\\pmb{X}),f\_{2q}(\\pmb{X}),\\cdots,f\_{pq}(\\pmb{X}) \\right\]^T \\\\\\\\ \\tag{12}\\text{vec}({\\pmb{F}(\\pmb{X}))}\\\\= \\left\[ f\_{11}(\\pmb{X}),f\_{21}(\\pmb{X}),\\cdots,f\_{p1}(\\pmb{X}),f\_{12}(\\pmb{X}),f\_{22}(\\pmb{X}),\\cdots,f\_{p2}(\\pmb{X}),\\cdots,f\_{1q}(\\pmb{X}),f\_{2q}(\\pmb{X}),\\cdots,f\_{pq}(\\pmb{X}) \\right\]^T \\\\\\\\ \\tag{12}

这样，我们就把一个**矩阵**变元的**实矩阵**函数 FF(XX)\\pmb{F}(\\pmb{X})\\pmb{F}(\\pmb{X}) ，转换成了**向量**变元的**实向量**函数 ff(xx)\\pmb{f}(\\pmb{x})\\pmb{f}(\\pmb{x}) 。接着，对照 (3)(3)(3) 式写出结果布局为 pq×mnpq\\times mnpq\\times mn 的矩阵：

(13)DXXFF(XX)\=∂vecpq×1(FF(XX))∂vecmn×1TXX\=\[∂f11∂x11∂f11∂x21⋯∂f11∂xm1∂f11∂x12∂f11∂x22⋯∂f11∂xm2⋯∂f11∂x1n∂f11∂x2n⋯∂f11∂xmn∂f21∂x11∂f21∂x21⋯∂f21∂xm1∂f21∂x12∂f21∂x22⋯∂f21∂xm2⋯∂f21∂x1n∂f21∂x2n⋯∂f21∂xmn⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮∂fp1∂x11∂fp1∂x21⋯∂fp1∂xm1∂fp1∂x12∂fp1∂x22⋯∂fp1∂xm2⋯∂fp1∂x1n∂fp1∂x2n⋯∂fp1∂xmn∂f12∂x11∂f12∂x21⋯∂f12∂xm1∂f12∂x12∂f12∂x22⋯∂f12∂xm2⋯∂f12∂x1n∂f12∂x2n⋯∂f12∂xmn∂f22∂x11∂f22∂x21⋯∂f22∂xm1∂f22∂x12∂f22∂x22⋯∂f22∂xm2⋯∂f22∂x1n∂f22∂x2n⋯∂f22∂xmn⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮∂fp2∂x11∂fp2∂x21⋯∂fp2∂xm1∂fp2∂x12∂fp2∂x22⋯∂fp2∂xm2⋯∂fp2∂x1n∂fp2∂x2n⋯∂fp2∂xmn⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮∂f1q∂x11∂f1q∂x21⋯∂f1q∂xm1∂f1q∂x12∂f1q∂x22⋯∂f1q∂xm2⋯∂f1q∂x1n∂f1q∂x2n⋯∂f1q∂xmn∂f2q∂x11∂f2q∂x21⋯∂f2q∂xm1∂f2q∂x12∂f2q∂x22⋯∂f2q∂xm2⋯∂f2q∂x1n∂f2q∂x2n⋯∂f2q∂xmn⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮∂fpq∂x11∂fpq∂x21⋯∂fpq∂xm1∂fpq∂x12∂fpq∂x22⋯∂fpq∂xm2⋯∂fpq∂x1n∂fpq∂x2n⋯∂fpq∂xmn\]pq×mn\\begin{align\*} \\text{D}\_{\\pmb{X}}\\pmb{F}(\\pmb{X}) &=\\frac{\\partial \\text{vec}\_{pq\\times 1}(\\pmb{F}\_{}(\\pmb{X}))}{\\partial \\text{vec}^T\_{mn\\times 1}\\pmb{X}} \\\\\\\\ &= \\left\[ \\matrix{ \\frac{\\partial f\_{11}}{\\partial x\_{11}}&\\frac{\\partial f\_{11}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{11}}{\\partial x\_{m1}}&\\frac{\\partial f\_{11}}{\\partial x\_{12}}&\\frac{\\partial f\_{11}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{11}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{11}}{\\partial x\_{1n}}&\\frac{\\partial f\_{11}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{11}}{\\partial x\_{mn}}\\\\ \\frac{\\partial f\_{21}}{\\partial x\_{11}}&\\frac{\\partial f\_{21}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{21}}{\\partial x\_{m1}}&\\frac{\\partial f\_{21}}{\\partial x\_{12}}&\\frac{\\partial f\_{21}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{21}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{21}}{\\partial x\_{1n}}&\\frac{\\partial f\_{21}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{21}}{\\partial x\_{mn}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{p1}}{\\partial x\_{11}}&\\frac{\\partial f\_{p1}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{m1}}&\\frac{\\partial f\_{p1}}{\\partial x\_{12}}&\\frac{\\partial f\_{p1}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{1n}}&\\frac{\\partial f\_{p1}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{mn}}\\\\ \\frac{\\partial f\_{12}}{\\partial x\_{11}}&\\frac{\\partial f\_{12}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{12}}{\\partial x\_{m1}}&\\frac{\\partial f\_{12}}{\\partial x\_{12}}&\\frac{\\partial f\_{12}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{12}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{12}}{\\partial x\_{1n}}&\\frac{\\partial f\_{12}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{12}}{\\partial x\_{mn}}\\\\ \\frac{\\partial f\_{22}}{\\partial x\_{11}}&\\frac{\\partial f\_{22}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{22}}{\\partial x\_{m1}}&\\frac{\\partial f\_{22}}{\\partial x\_{12}}&\\frac{\\partial f\_{22}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{22}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{22}}{\\partial x\_{1n}}&\\frac{\\partial f\_{22}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{22}}{\\partial x\_{mn}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{p2}}{\\partial x\_{11}}&\\frac{\\partial f\_{p2}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{m1}}&\\frac{\\partial f\_{p2}}{\\partial x\_{12}}&\\frac{\\partial f\_{p2}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{1n}}&\\frac{\\partial f\_{p2}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{mn}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{1q}}{\\partial x\_{11}}&\\frac{\\partial f\_{1q}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{m1}}&\\frac{\\partial f\_{1q}}{\\partial x\_{12}}&\\frac{\\partial f\_{1q}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{1n}}&\\frac{\\partial f\_{1q}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{mn}}\\\\ \\frac{\\partial f\_{2q}}{\\partial x\_{11}}&\\frac{\\partial f\_{2q}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{2q}}{\\partial x\_{m1}}&\\frac{\\partial f\_{2q}}{\\partial x\_{12}}&\\frac{\\partial f\_{2q}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{2q}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{2q}}{\\partial x\_{1n}}&\\frac{\\partial f\_{2q}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{2q}}{\\partial x\_{mn}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{pq}}{\\partial x\_{11}}&\\frac{\\partial f\_{pq}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{m1}}&\\frac{\\partial f\_{pq}}{\\partial x\_{12}}&\\frac{\\partial f\_{pq}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{1n}}&\\frac{\\partial f\_{pq}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{mn}}\\\\ } \\right\]\_{pq\\times mn} \\end{align\*} \\\\\\\\ \\tag{13}\\begin{align\*} \\text{D}\_{\\pmb{X}}\\pmb{F}(\\pmb{X}) &=\\frac{\\partial \\text{vec}\_{pq\\times 1}(\\pmb{F}\_{}(\\pmb{X}))}{\\partial \\text{vec}^T\_{mn\\times 1}\\pmb{X}} \\\\\\\\ &= \\left\[ \\matrix{ \\frac{\\partial f\_{11}}{\\partial x\_{11}}&\\frac{\\partial f\_{11}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{11}}{\\partial x\_{m1}}&\\frac{\\partial f\_{11}}{\\partial x\_{12}}&\\frac{\\partial f\_{11}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{11}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{11}}{\\partial x\_{1n}}&\\frac{\\partial f\_{11}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{11}}{\\partial x\_{mn}}\\\\ \\frac{\\partial f\_{21}}{\\partial x\_{11}}&\\frac{\\partial f\_{21}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{21}}{\\partial x\_{m1}}&\\frac{\\partial f\_{21}}{\\partial x\_{12}}&\\frac{\\partial f\_{21}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{21}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{21}}{\\partial x\_{1n}}&\\frac{\\partial f\_{21}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{21}}{\\partial x\_{mn}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{p1}}{\\partial x\_{11}}&\\frac{\\partial f\_{p1}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{m1}}&\\frac{\\partial f\_{p1}}{\\partial x\_{12}}&\\frac{\\partial f\_{p1}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{1n}}&\\frac{\\partial f\_{p1}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{mn}}\\\\ \\frac{\\partial f\_{12}}{\\partial x\_{11}}&\\frac{\\partial f\_{12}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{12}}{\\partial x\_{m1}}&\\frac{\\partial f\_{12}}{\\partial x\_{12}}&\\frac{\\partial f\_{12}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{12}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{12}}{\\partial x\_{1n}}&\\frac{\\partial f\_{12}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{12}}{\\partial x\_{mn}}\\\\ \\frac{\\partial f\_{22}}{\\partial x\_{11}}&\\frac{\\partial f\_{22}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{22}}{\\partial x\_{m1}}&\\frac{\\partial f\_{22}}{\\partial x\_{12}}&\\frac{\\partial f\_{22}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{22}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{22}}{\\partial x\_{1n}}&\\frac{\\partial f\_{22}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{22}}{\\partial x\_{mn}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{p2}}{\\partial x\_{11}}&\\frac{\\partial f\_{p2}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{m1}}&\\frac{\\partial f\_{p2}}{\\partial x\_{12}}&\\frac{\\partial f\_{p2}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{1n}}&\\frac{\\partial f\_{p2}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{mn}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{1q}}{\\partial x\_{11}}&\\frac{\\partial f\_{1q}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{m1}}&\\frac{\\partial f\_{1q}}{\\partial x\_{12}}&\\frac{\\partial f\_{1q}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{1n}}&\\frac{\\partial f\_{1q}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{mn}}\\\\ \\frac{\\partial f\_{2q}}{\\partial x\_{11}}&\\frac{\\partial f\_{2q}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{2q}}{\\partial x\_{m1}}&\\frac{\\partial f\_{2q}}{\\partial x\_{12}}&\\frac{\\partial f\_{2q}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{2q}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{2q}}{\\partial x\_{1n}}&\\frac{\\partial f\_{2q}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{2q}}{\\partial x\_{mn}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{pq}}{\\partial x\_{11}}&\\frac{\\partial f\_{pq}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{m1}}&\\frac{\\partial f\_{pq}}{\\partial x\_{12}}&\\frac{\\partial f\_{pq}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{1n}}&\\frac{\\partial f\_{pq}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{mn}}\\\\ } \\right\]\_{pq\\times mn} \\end{align\*} \\\\\\\\ \\tag{13}

**3.2 梯度矩阵**形式[\[6\]](#ref_6)

即先把**矩阵**变元 XX\\pmb{X}\\pmb{X} 按 vec\\text{vec}\\text{vec}**向量化**，转换成**向量**变元：

(7)vec(XX)\=\[x11,x21,⋯,xm1,x12,x22,⋯,xm2,⋯,x1n,x2n,⋯,xmn\]T\\text{vec}({\\pmb{X})}= \\left\[ x\_{11},x\_{21},\\cdots,x\_{m1},x\_{12},x\_{22},\\cdots,x\_{m2},\\cdots,x\_{1n},x\_{2n},\\cdots,x\_{mn} \\right\]^T \\\\\\\\ \\tag{7}\\text{vec}({\\pmb{X})}= \\left\[ x\_{11},x\_{21},\\cdots,x\_{m1},x\_{12},x\_{22},\\cdots,x\_{m2},\\cdots,x\_{1n},x\_{2n},\\cdots,x\_{mn} \\right\]^T \\\\\\\\ \\tag{7}

再把**实矩阵**函数 FF\\pmb{F}\\pmb{F} 按vec\\text{vec}\\text{vec}**向量化**，转换成**实向量**函数：

(12)vec(FF(XX))\=\[f11(XX),f21(XX),⋯,fp1(XX),f12(XX),f22(XX),⋯,fp2(XX),⋯,f1q(XX),f2q(XX),⋯,fpq(XX)\]T\\text{vec}({\\pmb{F}(\\pmb{X}))}\\\\= \\left\[ f\_{11}(\\pmb{X}),f\_{21}(\\pmb{X}),\\cdots,f\_{p1}(\\pmb{X}),f\_{12}(\\pmb{X}),f\_{22}(\\pmb{X}),\\cdots,f\_{p2}(\\pmb{X}),\\cdots,f\_{1q}(\\pmb{X}),f\_{2q}(\\pmb{X}),\\cdots,f\_{pq}(\\pmb{X}) \\right\]^T \\\\\\\\ \\tag{12}\\text{vec}({\\pmb{F}(\\pmb{X}))}\\\\= \\left\[ f\_{11}(\\pmb{X}),f\_{21}(\\pmb{X}),\\cdots,f\_{p1}(\\pmb{X}),f\_{12}(\\pmb{X}),f\_{22}(\\pmb{X}),\\cdots,f\_{p2}(\\pmb{X}),\\cdots,f\_{1q}(\\pmb{X}),f\_{2q}(\\pmb{X}),\\cdots,f\_{pq}(\\pmb{X}) \\right\]^T \\\\\\\\ \\tag{12}

这样，我们就把一个**矩阵**变元的**实矩阵**函数 FF(XX)\\pmb{F}(\\pmb{X})\\pmb{F}(\\pmb{X}) ，转换成了**向量**变元的**实向量**函数 ff(xx)\\pmb{f}(\\pmb{x})\\pmb{f}(\\pmb{x}) 。接着，对照 (4)(4)(4) 式写出结果布局为 mn×pqmn \\times pqmn \\times pq 的矩阵：

(14)∇XXFF(XX)\=∂vecpq×1T(FF(XX))∂vecmn×1XX\=\[∂f11∂x11∂f21∂x11⋯∂fp1∂x11∂f12∂x11∂f22∂x11⋯∂fp2∂x11⋯∂f1q∂x11∂f2q∂x11⋯∂fpq∂x11∂f11∂x21∂f21∂x21⋯∂fp1∂x21∂f12∂x21∂f22∂x21⋯∂fp2∂x21⋯∂f1q∂x21∂f2q∂x21⋯∂fpq∂x21⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮∂f11∂xm1∂f21∂xm1⋯∂fp1∂xm1∂f12∂xm1∂f22∂xm1⋯∂fp2∂xm1⋯∂f1q∂xm1∂f2q∂xm1⋯∂fpq∂xm1∂f11∂x12∂f21∂x12⋯∂fp1∂x12∂f12∂x12∂f22∂x12⋯∂fp2∂x12⋯∂f1q∂x12∂f2q∂x12⋯∂fpq∂x12∂f11∂x22∂f21∂x22⋯∂fp1∂x22∂f12∂x22∂f22∂x22⋯∂fp2∂x22⋯∂f1q∂x22∂f2q∂x22⋯∂fpq∂x22⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮∂f11∂xm2∂f21∂xm2⋯∂fp1∂xm2∂f12∂xm2∂f22∂xm2⋯∂fp2∂xm2⋯∂f1q∂xm2∂f2q∂xm2⋯∂fpq∂xm2⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮∂f11∂x1n∂f21∂x1n⋯∂fp1∂x1n∂f12∂x1n∂f22∂x1n⋯∂fp2∂x1n⋯∂f1q∂x1n∂f2q∂x1n⋯∂fpq∂x1n∂f11∂x2n∂f21∂x2n⋯∂fp1∂x2n∂f12∂x2n∂f22∂x2n⋯∂fp2∂x2n⋯∂f1q∂x2n∂f2q∂x2n⋯∂fpq∂x2n⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮⋮∂f11∂xmn∂f21∂xmn⋯∂fp1∂xmn∂f12∂xmn∂f22∂xmn⋯∂fp2∂xmn⋯∂f1q∂xmn∂f2q∂xmn⋯∂fpq∂xmn\]mn×pq\\begin{align\*} \\nabla\_{\\pmb{X}}\\pmb{F}(\\pmb{X}) &=\\frac{\\partial \\text{vec}\_{pq\\times 1}^T(\\pmb{F}\_{}(\\pmb{X}))}{\\partial \\text{vec}\_{mn\\times 1}\\pmb{X}} \\\\\\\\ &= \\left\[ \\matrix{ \\frac{\\partial f\_{11}}{\\partial x\_{11}}&\\frac{\\partial f\_{21}}{\\partial x\_{11}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{11}}&\\frac{\\partial f\_{12}}{\\partial x\_{11}}&\\frac{\\partial f\_{22}}{\\partial x\_{11}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{11}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{11}}&\\frac{\\partial f\_{2q}}{\\partial x\_{11}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{11}}\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{21}}&\\frac{\\partial f\_{21}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{21}}&\\frac{\\partial f\_{12}}{\\partial x\_{21}}&\\frac{\\partial f\_{22}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{21}}&\\frac{\\partial f\_{2q}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{21}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{m1}}&\\frac{\\partial f\_{21}}{\\partial x\_{m1}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{m1}}&\\frac{\\partial f\_{12}}{\\partial x\_{m1}}&\\frac{\\partial f\_{22}}{\\partial x\_{m1}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{m1}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{m1}}&\\frac{\\partial f\_{2q}}{\\partial x\_{m1}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{m1}}\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{12}}&\\frac{\\partial f\_{21}}{\\partial x\_{12}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{12}}&\\frac{\\partial f\_{12}}{\\partial x\_{12}}&\\frac{\\partial f\_{22}}{\\partial x\_{12}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{12}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{12}}&\\frac{\\partial f\_{2q}}{\\partial x\_{12}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{12}}\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{22}}&\\frac{\\partial f\_{21}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{22}}&\\frac{\\partial f\_{12}}{\\partial x\_{22}}&\\frac{\\partial f\_{22}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{22}}&\\frac{\\partial f\_{2q}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{22}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{m2}}&\\frac{\\partial f\_{21}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{m2}}&\\frac{\\partial f\_{12}}{\\partial x\_{m2}}&\\frac{\\partial f\_{22}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{m2}}&\\frac{\\partial f\_{2q}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{m2}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{1n}}&\\frac{\\partial f\_{21}}{\\partial x\_{1n}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{1n}}&\\frac{\\partial f\_{12}}{\\partial x\_{1n}}&\\frac{\\partial f\_{22}}{\\partial x\_{1n}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{1n}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{1n}}&\\frac{\\partial f\_{2q}}{\\partial x\_{1n}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{1n}}\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{2n}}&\\frac{\\partial f\_{21}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{2n}}&\\frac{\\partial f\_{12}}{\\partial x\_{2n}}&\\frac{\\partial f\_{22}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{2n}}&\\frac{\\partial f\_{2q}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{2n}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{mn}}&\\frac{\\partial f\_{21}}{\\partial x\_{mn}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{mn}}&\\frac{\\partial f\_{12}}{\\partial x\_{mn}}&\\frac{\\partial f\_{22}}{\\partial x\_{mn}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{mn}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{mn}}&\\frac{\\partial f\_{2q}}{\\partial x\_{mn}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{mn}}\\\\ } \\right\]\_{mn \\times pq} \\end{align\*} \\\\\\\\ \\tag{14}\\begin{align\*} \\nabla\_{\\pmb{X}}\\pmb{F}(\\pmb{X}) &=\\frac{\\partial \\text{vec}\_{pq\\times 1}^T(\\pmb{F}\_{}(\\pmb{X}))}{\\partial \\text{vec}\_{mn\\times 1}\\pmb{X}} \\\\\\\\ &= \\left\[ \\matrix{ \\frac{\\partial f\_{11}}{\\partial x\_{11}}&\\frac{\\partial f\_{21}}{\\partial x\_{11}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{11}}&\\frac{\\partial f\_{12}}{\\partial x\_{11}}&\\frac{\\partial f\_{22}}{\\partial x\_{11}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{11}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{11}}&\\frac{\\partial f\_{2q}}{\\partial x\_{11}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{11}}\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{21}}&\\frac{\\partial f\_{21}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{21}}&\\frac{\\partial f\_{12}}{\\partial x\_{21}}&\\frac{\\partial f\_{22}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{21}}&\\frac{\\partial f\_{2q}}{\\partial x\_{21}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{21}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{m1}}&\\frac{\\partial f\_{21}}{\\partial x\_{m1}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{m1}}&\\frac{\\partial f\_{12}}{\\partial x\_{m1}}&\\frac{\\partial f\_{22}}{\\partial x\_{m1}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{m1}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{m1}}&\\frac{\\partial f\_{2q}}{\\partial x\_{m1}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{m1}}\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{12}}&\\frac{\\partial f\_{21}}{\\partial x\_{12}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{12}}&\\frac{\\partial f\_{12}}{\\partial x\_{12}}&\\frac{\\partial f\_{22}}{\\partial x\_{12}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{12}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{12}}&\\frac{\\partial f\_{2q}}{\\partial x\_{12}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{12}}\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{22}}&\\frac{\\partial f\_{21}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{22}}&\\frac{\\partial f\_{12}}{\\partial x\_{22}}&\\frac{\\partial f\_{22}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{22}}&\\frac{\\partial f\_{2q}}{\\partial x\_{22}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{22}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{m2}}&\\frac{\\partial f\_{21}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{m2}}&\\frac{\\partial f\_{12}}{\\partial x\_{m2}}&\\frac{\\partial f\_{22}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{m2}}&\\frac{\\partial f\_{2q}}{\\partial x\_{m2}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{m2}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{1n}}&\\frac{\\partial f\_{21}}{\\partial x\_{1n}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{1n}}&\\frac{\\partial f\_{12}}{\\partial x\_{1n}}&\\frac{\\partial f\_{22}}{\\partial x\_{1n}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{1n}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{1n}}&\\frac{\\partial f\_{2q}}{\\partial x\_{1n}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{1n}}\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{2n}}&\\frac{\\partial f\_{21}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{2n}}&\\frac{\\partial f\_{12}}{\\partial x\_{2n}}&\\frac{\\partial f\_{22}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{2n}}&\\frac{\\partial f\_{2q}}{\\partial x\_{2n}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{2n}}\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots&\\vdots\\\\ \\frac{\\partial f\_{11}}{\\partial x\_{mn}}&\\frac{\\partial f\_{21}}{\\partial x\_{mn}}&\\cdots&\\frac{\\partial f\_{p1}}{\\partial x\_{mn}}&\\frac{\\partial f\_{12}}{\\partial x\_{mn}}&\\frac{\\partial f\_{22}}{\\partial x\_{mn}}&\\cdots&\\frac{\\partial f\_{p2}}{\\partial x\_{mn}}&\\cdots&\\frac{\\partial f\_{1q}}{\\partial x\_{mn}}&\\frac{\\partial f\_{2q}}{\\partial x\_{mn}}&\\cdots&\\frac{\\partial f\_{pq}}{\\partial x\_{mn}}\\\\ } \\right\]\_{mn \\times pq} \\end{align\*} \\\\\\\\ \\tag{14}

**3.3 一些发现**

**3.3.1 转置**

(13)(13)(13) 式与 (14)(14)(14) 式**互为转置**。

**3.3.2 相等1**

当**实矩阵**函数 FF\\pmb{F}\\pmb{F} 本身是一个**实值标量**函数 fff 时， (8)(8)(8) 式、(13)(13)(13) 式**相等；** (10)(10)(10) 式、 (14)(14)(14) 式**相等；**当然，前两个式子与后两个式子**互为转置**。

这一发现说明，对于**矩阵**变元的**实值标量**函数 f(XX)f(\\pmb{X})f(\\pmb{X}) , XXm×n\=(xij)i\=1,j\=1m,n\\pmb{X}\_{m\\times n}=(x\_{ij})\_{i=1,j=1}^{m,n}\\pmb{X}\_{m\\times n}=(x\_{ij})\_{i=1,j=1}^{m,n}，结果布局本质上有四种形式，第一种是 Jacobian\\text{Jacobian}\\text{Jacobian} 矩阵（**已经成行向量了**）形式，第二种是**梯度**矩阵（**已经成列向量了**）形式，第三种是 Jacobian\\text{Jacobian}\\text{Jacobian} 矩阵（**就是矩阵**）形式，第四种是**梯度**矩阵（**就是矩阵**）形式。第一种和第二种形式**互为转置**，第三种和第四种形式**互为转置**。

**3.3.3 相等2**

当**矩阵**变元 XX\\pmb{X}\\pmb{X} 本身就是一个**列向量** xx\=\[x1,x2,⋯,xn\]T\\pmb{x}=\[x\_1,x\_2,\\cdots,x\_n\]^T\\pmb{x}=\[x\_1,x\_2,\\cdots,x\_n\]^T 时， 同时**实矩阵**函数 FF\\pmb{F}\\pmb{F} 本身是一个**实值标量**函数 fff 时， (5)(5)(5) 式、 (8)(8)(8) 式、 (9)(9)(9) 式、 (13)(13)(13) 式**相等；** (6)(6)(6) 式、 (10)(10)(10) 式、 (11)(11)(11) 式、 (14)(14)(14) 式**相等；**当然，前四个式子与后四个式子**互为转置**。

这一发现仍说明，对于**向量**变元的**实值标量**函数 f(xx)f(\\pmb{x})f(\\pmb{x}) , xx\=\[x1,x2,⋯,xn\]T\\pmb{x}=\[x\_1,x\_2,\\cdots,x\_n\]^T\\pmb{x}=\[x\_1,x\_2,\\cdots,x\_n\]^T，结果布局本质上有两种形式，一种是 Jacobian\\text{Jacobian}\\text{Jacobian} 矩阵（**已经成行向量了**）形式，一种是**梯度**矩阵（**已经成列向量了**）形式。两种形式**互为转置**。

**4、矩阵**变元的**实向量**函数 ff(XX)\\pmb{f}(\\pmb{X})\\pmb{f}(\\pmb{X}) 、**向量**变元的**实向量**函数 ff(xx)\\pmb{f}(\\pmb{x})\\pmb{f}(\\pmb{x}) 、**向量**变元的**实矩阵**函数 FF(xx)\\pmb{F}(\\pmb{x})\\pmb{F}(\\pmb{x})

这三个都可以看做是**矩阵**变元的**实矩阵**函数 FF(XX)\\pmb{F}(\\pmb{X})\\pmb{F}(\\pmb{X}) ，可使用**3、**进行计算（因为向量就是一种特殊的矩阵）。

四. 分子布局、分母布局的本质
---------------

看到这里，相信同学们对矩阵求导结果的布局有了很全面的了解了，无非就是**分子的转置、向量化**，**分母的转置、向量化**，它们的**各种组合**而已。

结合上述知识，我们总结：

**1、分子布局的本质**：分子是**标量**、**列向量**、矩阵向量化后的**[列向量](https://zhida.zhihu.com/search?content_id=146747924&content_type=Article&match_order=16&q=%E5%88%97%E5%90%91%E9%87%8F&zhida_source=entity)**；分母是**标量**、列向量**转置**后的**行向量**、矩阵的**[转置矩阵](https://zhida.zhihu.com/search?content_id=146747924&content_type=Article&match_order=1&q=%E8%BD%AC%E7%BD%AE%E7%9F%A9%E9%98%B5&zhida_source=entity)**、矩阵向量化后的列向量**转置**后的**行向量**。包含 (5)(5)(5) 式、 (8)(8)(8) 式、 (9)(9)(9) 式、 (13)(13)(13) 式。

**2、分母布局的本质**：分子是**标量**、列向量**转置**后的**行向量**、矩阵向量化后的列向量**转置**后的**行向量**；分母是**标量**、**列向量**、**矩阵自己**、矩阵向量化后的**列向量**。包含 (6)(6)(6) 式、 (10)(10)(10) 式、 (11)(11)(11) 式、 (14)(14)(14) 式。

思考一下，其实我们可以再简洁一些：**谁转置了，就是另一方的布局**。分子转置了，就是分母布局；分母转置了，就是分子布局。

最终，我们列一个表格，总结分子布局、分子布局的本质：

![](https://picx.zhimg.com/v2-6be5f7d3c49580ce564e302be90a559f_1440w.jpg)

分子布局、分母布局的本质

五. 完
----

本文到这里就结束了，希望对大家有帮助。如果有时间的话，后面我会再发一篇文章，来进行**若干常见矩阵求导公式的数学推导。**欢迎大家点赞、关注、收藏、转发噢~

![](https://pic3.zhimg.com/v2-0d149ee0c5cd6a972e79fc0f07a553d6_1440w.png)

_矩阵求导系列其他文章：_

[对称矩阵的求导，以多元正态分布的极大似然估计为例（矩阵求导——补充篇） - Iterator的文章 - 知乎](https://zhuanlan.zhihu.com/p/305171795)

[矩阵求导公式的数学推导（矩阵求导——进阶篇） - Iterator的文章 - 知乎](https://zhuanlan.zhihu.com/p/288541909)

[矩阵求导公式的数学推导（矩阵求导——基础篇） - Iterator的文章 - 知乎](https://zhuanlan.zhihu.com/p/273729929)

参考
--

1.  [^](#ref_1_0)张贤达《矩阵分析与应用（第二版）》P143
2.  [^](#ref_2_0)《高等数学 同济大学第七版 下册》P66
3.  ^[a](#ref_3_0)[b](#ref_3_1)[c](#ref_3_2)张贤达《矩阵分析与应用（第二版）》P144
4.  ^[a](#ref_4_0)[b](#ref_4_1)[c](#ref_4_2)张贤达《矩阵分析与应用（第二版）》P146
5.  [^](#ref_5_0)张贤达《矩阵分析与应用（第二版）》P145
6.  [^](#ref_6_0)张贤达《矩阵分析与应用（第二版）》P147

本文转自 <https://zhuanlan.zhihu.com/p/263777564>，如有侵权，请联系删除。