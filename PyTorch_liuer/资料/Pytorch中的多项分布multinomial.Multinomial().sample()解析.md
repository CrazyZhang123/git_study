 

> åœ¨è¯»ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  Pytorchã€‹ï¼Œç–‘æƒ‘äºï¼š
> 
> ```python
> fair_probs = torch.ones([6]) / 6
> multinomial.Multinomial(1, fair_probs).sample()
> ```
> 
> æ•…æœ‰æ­¤ç¯‡æ–‡ç« ã€‚
> 
> P.S. å¿ƒæ€å´©äº†ï¼ŒTyporaå‡ºbugï¼Œæ²¡ä¿å­˜ ğŸ˜¦

```python
# å¯¼å…¥å¿…è¦çš„åŒ…
import torch
from torch.distributions import multinomial
```

å¤šé¡¹åˆ†å¸ƒ**Multinomial()**æ˜¯**torch.distributions.multinomial**ä¸­çš„ä¸€ä¸ªç±»ï¼Œæ¥å—å››ä¸ªå‚æ•°(**total\_count**\=**1**, **probs**\=**None**, **logits**\=**None**, **validate\_args**\=**None**)ï¼š

**total\_count**æ¥å—çš„æ˜¯**int**å‹å‚æ•°ï¼ŒæŒ‡çš„æ˜¯å•æ¬¡æŠ½æ ·ä¸­æ ·æœ¬çš„ä¸ªæ•°ã€‚

**probs**æ¥å—çš„æ˜¯**Tensor**å‹å‚æ•°ï¼ŒæŒ‡çš„æ˜¯å„äº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥é¢‘æ•°ã€‚å¦‚æœä¼ å…¥çš„æ˜¯é¢‘æ•°ï¼Œå¯ä»¥é€šè¿‡**probs**å±æ€§æŸ¥çœ‹å¯¹åº”çš„æ¦‚ç‡åˆ†å¸ƒã€‚

```python
>> fair_probs = torch.ones([6]) / 6	# ä¾‹å­æ¥æºäºã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  Pytorchã€‹
>> multinomial.Multinomial(1, fair_probs).probs

tensor([0.1667, 0.1667, 0.1667, 0.1667, 0.1667, 0.1667])

>> fair_probs = torch.ones([6])	# å¯ä»¥çœ‹åˆ°ä¼ å…¥é¢‘æ•°å’Œæ¦‚ç‡çš„ç»“æœæ˜¯ä¸€æ ·çš„
>> torch.ones([6])/6 == multinomial.Multinomial(1, fair_probs).probs

tensor([True, True, True, True, True, True])
```

**logits**æ¥å—çš„æ˜¯**Tensor**å‹å‚æ•°ï¼Œå’Œ**probs**çš„ä½œç”¨ä¸€æ ·ï¼Œä¸è¿‡å…¶æŒ‡çš„æ˜¯å„äº‹ä»¶æ¦‚ç‡çš„è‡ªç„¶å¯¹æ•°ï¼ŒåŒæ ·çš„ä¹Ÿå¯ä»¥ä¼ å…¥é¢‘æ•°ï¼Œåœ¨ä¼ å…¥é¢‘æ•°åå¯ä»¥é€šè¿‡**logits**å±æ€§æŸ¥çœ‹å¯¹åº”çš„å¯¹æ•°æ¦‚ç‡åˆ†å¸ƒã€‚

```python
>> fair_probs = torch.ones([6]) / 6	# ä¾‹å­æ¥æºäºã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  Pytorchã€‹
>> multinomial.Multinomial(1, fair_probs).logits

tensor([-1.7918, -1.7918, -1.7918, -1.7918, -1.7918, -1.7918])

>> fair_probs = torch.ones([6])	# å¯ä»¥çœ‹åˆ°ä¼ å…¥é¢‘æ•°å’Œæ¦‚ç‡çš„ç»“æœæ˜¯ä¸€æ ·çš„
>> torch.log(torch.ones([6]) / 6) = multinomial.Multinomial(1, fair_probs).logits

tensor([True, True, True, True, True, True])
```

**validate\_args**ç”¨äºæŒ‡å®šæ˜¯å¦æ£€æŸ¥å‚æ•°çš„åˆæ³•æ€§ï¼Œä½†å¥‡æ€ªçš„ä¸€ç‚¹æ˜¯ï¼Œå³ä¾¿è®¾ç½®å®ƒä¸º**False**ï¼Œä¾ç„¶ä¼šå¯¹ä¸åˆç†çš„å‚æ•°æŠ›å‡ºå¼‚å¸¸ã€‚è¿™é‡Œæˆ‘å¼•ç”¨ChatGPTå›ç­”åŸ‹ä¸ªå‘ï¼š

> åœ¨ PyTorch ä¸­ï¼Œ`validate_args=True` è¡¨ç¤ºåˆ†å¸ƒçš„å‚æ•°å°†å§‹ç»ˆè¿›è¡Œå®Œæ•´çš„æ£€æŸ¥ï¼Œä»¥ç¡®ä¿å®ƒä»¬å…·æœ‰è‰¯å¥½çš„æ•°å€¼ç‰¹æ€§å’Œåˆæ³•æ€§ã€‚è¿™é€šå¸¸ä¼šå¯¼è‡´è¾ƒæ…¢çš„è¿è¡Œé€Ÿåº¦å’Œæ›´é«˜çš„è®¡ç®—æˆæœ¬ï¼Œä½†å¯ä»¥æä¾›æ›´åŠ å¥å£®å’Œå¯é çš„ä»£ç ã€‚
> 
> ç›¸æ¯”ä¹‹ä¸‹ï¼Œ`validate_args=False` è¡¨ç¤ºåˆ†å¸ƒçš„å‚æ•°åªè¿›è¡ŒåŸºæœ¬çš„æ£€æŸ¥ï¼Œä»¥æé«˜ä»£ç çš„[æ€§èƒ½](https://marketing.csdn.net/p/3127db09a98e0723b83b2914d9256174?pId=2782?utm_source=glcblog&spm=1001.2101.3001.7020)å’Œæ•ˆç‡ã€‚è¿™é€šå¸¸ä¼šå¯¼è‡´æ›´å¿«çš„è¿è¡Œé€Ÿåº¦å’Œæ›´ä½çš„è®¡ç®—æˆæœ¬ï¼Œä½†å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é£é™©å’Œä¸ç¡®å®šæ€§ï¼Œç‰¹åˆ«æ˜¯å½“å‚æ•°å­˜åœ¨ä¸åˆæ³•æˆ–å¼‚å¸¸å€¼æ—¶ã€‚
> 
> å…·ä½“è€Œè¨€ï¼Œå½“ `validate_args=True` æ—¶ï¼ŒPyTorch ä¼šè¿›è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š
> 
> *   å‚æ•°æ˜¯å¦æ»¡è¶³åˆ†å¸ƒçš„ç‰¹å®šè¦æ±‚ï¼Œä¾‹å¦‚ï¼Œå‚æ•°æ˜¯å¦éœ€è¦æ˜¯æ­£æ•´æ•°ã€å®æ•°ã€æ­£å®šçŸ©é˜µç­‰ï¼›
> *   å‚æ•°æ˜¯å¦å­˜åœ¨éæ³•å€¼æˆ–å¼‚å¸¸å€¼ï¼Œä¾‹å¦‚ï¼Œæ˜¯å¦å­˜åœ¨ NaNã€infã€è´Ÿæ•°ç­‰ï¼›
> *   å‚æ•°æ˜¯å¦æ»¡è¶³ç‰¹å®šçš„çº¦æŸæ¡ä»¶ï¼Œä¾‹å¦‚ï¼Œå‚æ•°æ˜¯å¦éœ€è¦å¤§äºç­‰äºæŸä¸ªå€¼ã€å°äºç­‰äºæŸä¸ªå€¼ã€æ€»å’Œä¸º1ç­‰ï¼›
> *   å‚æ•°æ˜¯å¦ä¸å…¶ä»–å‚æ•°ç›¸å®¹ï¼Œä¾‹å¦‚ï¼ŒæŸäº›å‚æ•°æ˜¯å¦éœ€è¦å…·æœ‰ç›¸åŒçš„å¤§å°ã€å½¢çŠ¶ã€ç»´åº¦ç­‰ã€‚
> 
> å½“ `validate_args=False` æ—¶ï¼ŒPyTorch é€šå¸¸åªè¿›è¡ŒåŸºæœ¬çš„æ£€æŸ¥ï¼Œä¾‹å¦‚ï¼Œå‚æ•°æ˜¯å¦ä¸º None æˆ–ç©ºå€¼ã€æ˜¯å¦å…·æœ‰æ­£ç¡®çš„ç±»å‹ã€æ˜¯å¦å…·æœ‰æ­£ç¡®çš„å½¢çŠ¶ç­‰ã€‚è¿™äº›æ£€æŸ¥é€šå¸¸ä¸éœ€è¦è€—è´¹å¤ªå¤šè®¡ç®—èµ„æºï¼Œå› æ­¤å¯ä»¥æé«˜ä»£ç çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼ä¹Ÿå¯èƒ½ä¼šå¿½ç•¥ä¸€äº›ä¸åˆæ³•æˆ–å¼‚å¸¸å€¼ï¼Œä»è€Œå¼•å‘ä¸€äº›æ½œåœ¨çš„é£é™©å’Œä¸ç¡®å®šæ€§ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ `validate_args=False` æ—¶éœ€è¦è°¨æ…ï¼Œå¹¶ä¸”æœ€å¥½å°½å¯èƒ½é¿å…ä½¿ç”¨ä¸åˆæ³•æˆ–å¼‚å¸¸çš„å‚æ•°ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå›ç­”å¹¶ä¸ä¸€å®šä¼šæ˜¯æ­£ç¡®çš„ï¼Œåœ¨æˆ‘çªå‘å¥‡æƒ³å»é—®ChatGPT Multinomial()å‚æ•°ç›¸å…³é—®é¢˜æ—¶ï¼Œå®ƒç­”é”™äº†ä¸‰æ¬¡ä»¥ä¸Šï¼Œæ¯”å¦‚ï¼š

> ä»¥ä¸‹æ˜¯é”™è¯¯å›ç­”çš„æ‘˜é€‰ï¼š
> 
> 1.  `probs` å’Œ `logits` äºŒé€‰ä¸€å³å¯ï¼Œå¦‚æœéƒ½æŒ‡å®šäº†ï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨ `probs`ã€‚å¦‚æœä¸¤ä¸ªå‚æ•°éƒ½æ²¡æœ‰æŒ‡å®šï¼Œåˆ™é»˜è®¤ä½¿ç”¨ `probs=torch.tensor([1/K, ..., 1/K])`ï¼Œå…¶ä¸­ `K` è¡¨ç¤ºç¦»æ•£éšæœºå˜é‡çš„æ•°é‡ã€‚
> 
> **è€Œå®é™…ä¸­ï¼Œå¦‚æœä¸¤ä¸ªå‚æ•°éƒ½æŒ‡å®šæˆ–éƒ½æ²¡æœ‰æŒ‡å®šï¼Œä¼šæŠ›å‡ºValueError: Either `probs` or `logits` must be specified, but not both.**
> 
> 2.  å¦‚æœä¼ é€’çš„ `probs` å¼ é‡åŒ…å«äº†è´Ÿæ•°æˆ–å¤§äº1çš„æ•°ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚
> 
> **æˆ‘ä»¬ä»ä¹‹å‰çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¼ é€’å¤§äº1çš„é¢‘æ•°æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ï¼Œæºç ä¸­å¯¹äºprobså‚æ•°çš„çº¦æŸæ˜¯ï¼šmust be non-negative, finite and have a non-zero sumï¼ˆéè´Ÿï¼Œæœ‰é™ï¼Œéé›¶å’Œï¼‰**
> 
> 3.  å¦‚æœå°† `validate_args` è®¾ç½®ä¸º `False`ï¼Œåˆ™ä¸ä¼šè¿›è¡Œå‚æ•°åˆæ³•æ€§æ£€æŸ¥ï¼Œè¿™å¯ä»¥æé«˜ä»£ç çš„æ‰§è¡Œæ•ˆç‡ã€‚
> 
> **è¿™æ˜¯é”™è¯¯çš„ï¼Œå³ä¾¿ä½ å°†validate\_argsè®¾ç½®ä¸ºFalseï¼Œä¹Ÿä¼šæ£€æµ‹å‚æ•°çš„åˆæ³•æ€§ï¼Œæ¯”å¦‚ï¼šprobsä¸­çš„æŸä¸ªé‡ä¸ºè´Ÿæ•°**
> 
> å¯ä»¥çœ‹åˆ°ç¬¬ä¸‰ä¸ªå›ç­”å’Œå‰é¢æˆ‘è¯´â€œåŸ‹ä¸ªå‘çš„å›ç­”â€æ˜¯çŸ›ç›¾çš„ï¼Œæ‰€ä»¥è¯·ä¸è¦å°½ä¿¡ChatGPTã€‚

**sample**()æ˜¯ç±»**Multinomial**()ä¸­ç”¨æ¥æŠ½æ ·çš„[å‡½æ•°](https://marketing.csdn.net/p/3127db09a98e0723b83b2914d9256174?pId=2782?utm_source=glcblog&spm=1001.2101.3001.7020)ï¼Œä»…æ¥æ”¶ä¸€ä¸ªå‚æ•° (**sample\_shape=torch.Size()**)ï¼Œç”¨æ¥æŒ‡å®šè¦æŠ½æ ·çš„æ¬¡æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹ä»…æŠ½æ ·ä¸€æ¬¡ï¼Œè¾“å‡ºä¸€ä¸ªå½¢çŠ¶ä¸º(**len(probs),** )çš„å¼ é‡ï¼Œå¦åˆ™ï¼Œè¾“å‡ºä¸º(**sample\_shape, len(probs)**)çš„å¼ é‡ã€‚

```python
>> fair_probs = torch.ones([6])/6
>> multinomial.Multinomial(1, fair_probs).sample().size()

torch.Size([6])

>> multinomial.Multinomial(1, fair_probs).sample((5, 3)).size()

torch.Size([5, 3, 6])
```

æœ¬æ–‡è½¬è‡ª <https://blog.csdn.net/weixin_42426841/article/details/129317453?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522495bec3942132beeb1ba2242e67cb000%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=495bec3942132beeb1ba2242e67cb000&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-129317453-null-null.142^v100^pc_search_result_base5&utm_term=multinomial.Multinomial%281%2C%20fair_probs%29.sample%28%29&spm=1018.2226.3001.4187>ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ã€‚